{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Lenovo\\\\OneDrive\\\\Desktop\\\\Capstone-Project-jun\\\\main-domain\\\\frontend\\\\src\\\\components\\\\Tenants\\\\Inquiries.js\",\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport api from '../../services/api';\n\n// Props:\n// - onClose(): close modal\n// - initialChat: { id?, managerName, property, unitId, propertyId }\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Inquiries = ({\n  onClose,\n  initialChat = null\n}) => {\n  _s2();\n  var _s = $RefreshSig$();\n  const [message, setMessage] = useState('');\n  const [chats, setChats] = useState([]); // [{id, managerName, property, avatar, status, messages: [{id, sender, text, time}]}]\n  const [selectedChatId, setSelectedChatId] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [uploadingFiles, setUploadingFiles] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState([]);\n  const [attachments, setAttachments] = useState({}); // {inquiryId: [attachments]}\n  const hydratedRef = useRef(false);\n  const preFilledMessageRef = useRef(new Set()); // Track which chats have had messages pre-filled\n  const messageInputRef = useRef(null); // Reference to the message input element\n  const fileInputRef = useRef(null);\n  const [lightboxImage, setLightboxImage] = useState(null); // {url, fileName} for lightbox modal\n\n  // Media Display Component\n  const MediaDisplay = ({\n    attachment,\n    type,\n    getMediaUrl,\n    getAttachmentUrl,\n    onImageClick\n  }) => {\n    _s();\n    const [url, setUrl] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(false);\n    useEffect(() => {\n      let isMounted = true;\n      setLoading(true);\n      setError(false);\n      console.log('MediaDisplay: Loading attachment', attachment.id, attachment.file_name, attachment.mime_type);\n      getMediaUrl(attachment.id).then(mediaUrl => {\n        if (isMounted) {\n          if (mediaUrl) {\n            console.log('MediaDisplay: Successfully loaded media URL for', attachment.id);\n            setUrl(mediaUrl);\n            setLoading(false);\n          } else {\n            console.error('MediaDisplay: Failed to get media URL for attachment:', attachment.id);\n            setError(true);\n            setLoading(false);\n          }\n        }\n      }).catch(err => {\n        if (isMounted) {\n          console.error('MediaDisplay: Error loading media:', err, attachment);\n          setError(true);\n          setLoading(false);\n        }\n      });\n      return () => {\n        isMounted = false;\n        if (url) {\n          window.URL.revokeObjectURL(url);\n        }\n      };\n    }, [attachment.id]);\n    if (error) return null;\n    if (loading) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full h-48 bg-gray-300 flex items-center justify-center\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }, this);\n    }\n    if (!url) return null;\n    if (type === 'image') {\n      return /*#__PURE__*/_jsxDEV(\"img\", {\n        src: url,\n        alt: attachment.file_name,\n        className: \"w-full h-auto max-h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity\",\n        onClick: () => onImageClick && onImageClick({\n          url,\n          fileName: attachment.file_name\n        }),\n        onError: () => setError(true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 9\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(\"video\", {\n        src: url,\n        controls: true,\n        className: \"w-full h-auto max-h-64 object-cover\",\n        onError: () => setError(true),\n        children: \"Your browser does not support the video tag.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this);\n    }\n  };\n\n  // Helper to get attachment URL (for download)\n  _s(MediaDisplay, \"ZqLwh7nbnbM28q9peEOGNB1gU4k=\");\n  const getAttachmentUrl = attachmentId => {\n    return `${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/inquiries/attachments/${attachmentId}`;\n  };\n\n  // Helper to get authenticated image/video URL\n  const [mediaUrls, setMediaUrls] = useState({}); // Cache for blob URLs\n  const getMediaUrl = async attachmentId => {\n    if (mediaUrls[attachmentId]) return mediaUrls[attachmentId];\n    try {\n      const blob = await api.downloadInquiryAttachment(attachmentId);\n\n      // Verify that we got a Blob object\n      if (!blob || !(blob instanceof Blob)) {\n        console.error('Invalid blob response:', blob);\n        return null;\n      }\n      const url = window.URL.createObjectURL(blob);\n      setMediaUrls(prev => ({\n        ...prev,\n        [attachmentId]: url\n      }));\n      return url;\n    } catch (error) {\n      console.error('Failed to load media:', error);\n      return null;\n    }\n  };\n\n  // Helper to check if file is image\n  const isImage = (mimeType, fileType) => {\n    return mimeType && mimeType.startsWith('image/') || fileType && ['image', 'jpg', 'jpeg', 'png', 'gif', 'webp'].includes(fileType.toLowerCase());\n  };\n\n  // Helper to check if file is video\n  const isVideo = (mimeType, fileType) => {\n    return mimeType && mimeType.startsWith('video/') || fileType && ['video', 'mp4', 'mov', 'avi', 'webm'].includes(fileType.toLowerCase());\n  };\n\n  // Helper to get attachments for a specific message (by matching timestamp within 30 seconds)\n  const getMessageAttachments = (message, inquiryId) => {\n    if (!attachments[inquiryId] || !message.created_at) return [];\n    const messageTime = new Date(message.created_at).getTime();\n    return attachments[inquiryId].filter(att => {\n      if (!att.created_at) return false;\n      const attTime = new Date(att.created_at).getTime();\n      // Match attachments uploaded within 30 seconds of message (more flexible)\n      return Math.abs(messageTime - attTime) < 30000;\n    });\n  };\n\n  // Helper to get unmatched attachments (attachments that don't belong to any message)\n  const getUnmatchedAttachments = (inquiryId, messages) => {\n    if (!attachments[inquiryId] || !messages || messages.length === 0) {\n      // If no messages, show all attachments\n      return attachments[inquiryId] || [];\n    }\n    const matchedAttachmentIds = new Set();\n    messages.forEach(msg => {\n      if (msg.created_at) {\n        const messageAttachments = getMessageAttachments(msg, inquiryId);\n        messageAttachments.forEach(att => matchedAttachmentIds.add(att.id));\n      }\n    });\n\n    // Return attachments that weren't matched to any message\n    return (attachments[inquiryId] || []).filter(att => !matchedAttachmentIds.has(att.id));\n  };\n\n  // Helper function to format time consistently\n  const formatMessageTime = dateString => {\n    if (!dateString) {\n      const now = new Date();\n      return now.toLocaleTimeString([], {\n        hour: 'numeric',\n        minute: '2-digit'\n      });\n    }\n    try {\n      let date;\n      if (dateString instanceof Date) {\n        date = dateString;\n      } else if (typeof dateString === 'string') {\n        // If the string doesn't have timezone info, assume it's UTC from the backend\n        // Backend sends ISO format which may or may not have 'Z' suffix\n        let normalizedString = dateString.trim();\n        if (!normalizedString.endsWith('Z') && !normalizedString.includes('+') && !normalizedString.includes('-', 10)) {\n          // No timezone indicator, assume UTC\n          normalizedString = normalizedString.endsWith('Z') ? normalizedString : normalizedString + 'Z';\n        }\n        date = new Date(normalizedString);\n      } else if (typeof dateString === 'number') {\n        // Timestamp in milliseconds\n        date = new Date(dateString);\n      } else {\n        date = new Date(dateString);\n      }\n      if (isNaN(date.getTime())) {\n        console.warn('Invalid date:', dateString);\n        return new Date().toLocaleTimeString([], {\n          hour: 'numeric',\n          minute: '2-digit'\n        });\n      }\n\n      // Format in local timezone\n      return date.toLocaleTimeString([], {\n        hour: 'numeric',\n        minute: '2-digit'\n      });\n    } catch (error) {\n      console.error('Error formatting time:', error, dateString);\n      return new Date().toLocaleTimeString([], {\n        hour: 'numeric',\n        minute: '2-digit'\n      });\n    }\n  };\n\n  // Load inquiries from backend API\n  const loadInquiries = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Check if user is authenticated\n      const accessToken = localStorage.getItem('access_token') || localStorage.getItem('token');\n      if (!accessToken) {\n        setError('Please log in to view your inquiries.');\n        setLoading(false);\n        return;\n      }\n      const response = await api.getTenantInquiries();\n      if (response && response.inquiries) {\n        // Helper: explode concatenated text (tenant + manager) into chronological bubbles with embedded timestamps\n        const toMessages = inq => {\n          // Start with messages from inquiry_messages table if available (new format)\n          const newFormatMsgs = [];\n          if (inq.messages && Array.isArray(inq.messages) && inq.messages.length > 0) {\n            inq.messages.forEach(msg => {\n              newFormatMsgs.push({\n                id: `msg-${msg.id}`,\n                sender: msg.sender || (msg.sender_id === inq.tenant_id ? 'tenant' : 'manager'),\n                text: msg.message || msg.text || '',\n                time: formatMessageTime(msg.created_at),\n                created_at: msg.created_at\n              });\n            });\n          }\n\n          // Parse old format messages (for backward compatibility and initial messages)\n          const oldFormatMsgs = [];\n\n          // Fallback: Parse old format messages (for backward compatibility)\n          const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n          const chunks = [];\n          let lastIndex = 0;\n          let match;\n          while ((match = regex.exec(String(inq.message || ''))) !== null) {\n            const ts = match[1] ? Number(match[1]) : null;\n            const text = String(inq.message || '').slice(lastIndex, match.index);\n            if (text) chunks.push({\n              text,\n              ts: null\n            });\n            lastIndex = match.index + match[0].length;\n            chunks.push({\n              text: null,\n              ts\n            });\n          }\n          const tail = String(inq.message || '').slice(lastIndex);\n          if (tail) chunks.push({\n            text: tail,\n            ts: null\n          });\n\n          // Merge markers (ts) with following text blocks\n          const parts = [];\n          let pendingTs = null;\n          for (const c of chunks) {\n            if (c.text === null && c.ts) {\n              pendingTs = c.ts;\n            } else if (c.text) {\n              parts.push({\n                text: c.text,\n                ts: pendingTs\n              });\n              pendingTs = null;\n            }\n          }\n          parts.forEach((p, idx) => {\n            let cleanText = p.text || '';\n            cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n            cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n            if (!cleanText) return;\n            const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n            if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n              return;\n            }\n            oldFormatMsgs.push({\n              id: `${inq.id}-t-${idx}`,\n              sender: 'tenant',\n              text: cleanText,\n              time: formatMessageTime(p.ts ? new Date(p.ts) : new Date()),\n              created_at: p.ts ? new Date(p.ts).toISOString() : new Date().toISOString()\n            });\n          });\n\n          // Also explode manager replies stored in response_message (old format)\n          if (inq.response_message) {\n            const mSep = /\\n\\n--- Manager Reply \\[(\\d{10,})\\] ---\\n/g;\n            const mSrc = String(inq.response_message || '');\n            const mParts = [];\n            let mLast = 0;\n            let mm;\n            while ((mm = mSep.exec(mSrc)) !== null) {\n              const txt = mSrc.slice(mLast, mm.index);\n              if (txt) mParts.push({\n                text: txt,\n                ts: null\n              });\n              mParts.push({\n                text: null,\n                ts: mm[1] ? Number(mm[1]) : null\n              });\n              mLast = mm.index + mm[0].length;\n            }\n            const mTail = mSrc.slice(mLast);\n            if (mTail) mParts.push({\n              text: mTail,\n              ts: null\n            });\n            let mPending = null;\n            const now = Date.now();\n            for (const part of mParts) {\n              if (part.text === null) {\n                mPending = part.ts;\n                continue;\n              }\n              let cleanText = part.text || '';\n              cleanText = cleanText.replace(/^---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n              cleanText = cleanText.replace(/\\s*---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n              if (!cleanText) continue;\n              oldFormatMsgs.push({\n                id: `${inq.id}-m-${oldFormatMsgs.length}`,\n                sender: 'manager',\n                text: cleanText,\n                time: formatMessageTime(mPending ? new Date(mPending) : new Date(now)),\n                created_at: mPending ? new Date(mPending).toISOString() : new Date(now).toISOString()\n              });\n              mPending = null;\n            }\n          }\n\n          // Merge new format and old format messages, removing duplicates\n          const allMsgs = [...newFormatMsgs, ...oldFormatMsgs];\n\n          // Remove duplicates based on text content and sender\n          const uniqueMsgs = [];\n          const seenTexts = new Set();\n          for (const msg of allMsgs) {\n            const textKey = `${msg.sender}-${msg.text}`;\n            if (!seenTexts.has(textKey)) {\n              seenTexts.add(textKey);\n              uniqueMsgs.push(msg);\n            }\n          }\n\n          // Sort by created_at timestamp or time\n          uniqueMsgs.sort((a, b) => {\n            const timeA = a.created_at ? new Date(a.created_at).getTime() : a.time ? new Date(`2000-01-01 ${a.time}`).getTime() : 0;\n            const timeB = b.created_at ? new Date(b.created_at).getTime() : b.time ? new Date(`2000-01-01 ${b.time}`).getTime() : 0;\n            return timeA - timeB;\n          });\n          return uniqueMsgs;\n        };\n\n        // Map and de-duplicate by propertyId\n        const mapped = response.inquiries.map(inquiry => {\n          var _inquiry$property_man, _inquiry$property_man2, _inquiry$property, _inquiry$property2, _inquiry$property3, _inquiry$property4;\n          return {\n            id: inquiry.id,\n            managerName: (((_inquiry$property_man = inquiry.property_manager) === null || _inquiry$property_man === void 0 ? void 0 : _inquiry$property_man.first_name) || 'Property') + ' ' + (((_inquiry$property_man2 = inquiry.property_manager) === null || _inquiry$property_man2 === void 0 ? void 0 : _inquiry$property_man2.last_name) || 'Manager'),\n            property: ((_inquiry$property = inquiry.property) === null || _inquiry$property === void 0 ? void 0 : _inquiry$property.title) || ((_inquiry$property2 = inquiry.property) === null || _inquiry$property2 === void 0 ? void 0 : _inquiry$property2.building_name) || 'Property',\n            propertyId: inquiry.property_id,\n            unitId: inquiry.unit_id || inquiry.property_id,\n            unitName: inquiry.unit_name || ((_inquiry$property3 = inquiry.property) === null || _inquiry$property3 === void 0 ? void 0 : _inquiry$property3.title) || ((_inquiry$property4 = inquiry.property) === null || _inquiry$property4 === void 0 ? void 0 : _inquiry$property4.building_name) || 'Property',\n            avatar: 'ðŸ¢',\n            status: inquiry.status,\n            messages: toMessages(inquiry),\n            attachments: inquiry.attachments || [],\n            inquiry\n          };\n        });\n        const dedup = [];\n        const seen = new Set();\n        for (const c of mapped) {\n          const key = String(c.propertyId);\n          if (seen.has(key)) continue;\n          seen.add(key);\n          dedup.push(c);\n        }\n        setChats(dedup);\n\n        // Load attachments for all inquiries\n        for (const chat of dedup) {\n          try {\n            const attData = await api.getInquiryAttachments(chat.id);\n            if (attData && attData.attachments) {\n              setAttachments(prev => ({\n                ...prev,\n                [chat.id]: attData.attachments\n              }));\n            }\n          } catch (err) {\n            console.error(`Failed to load attachments for inquiry ${chat.id}:`, err);\n          }\n        }\n      }\n    } catch (err) {\n      console.error('Failed to load inquiries:', err);\n      if (err.status === 401) {\n        setError('Please log in to view your inquiries.');\n        // Optionally redirect to login\n        // window.location.href = '/login';\n      } else {\n        setError('Failed to load inquiries. Please try again.');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Load inquiries on mount\n  useEffect(() => {\n    loadInquiries();\n    hydratedRef.current = true;\n  }, []);\n\n  // Persist chats and selection whenever they change\n  useEffect(() => {\n    if (!hydratedRef.current) return; // avoid wiping storage with initial empty state\n    try {\n      if (Array.isArray(chats)) localStorage.setItem('tenant_chats', JSON.stringify(chats));\n      if (selectedChatId) {\n        localStorage.setItem('tenant_selected_chat_id', selectedChatId);\n      }\n    } catch (_) {\n      // storage may be unavailable\n    }\n  }, [chats, selectedChatId]);\n\n  // Create or reuse inquiry when opened from \"INQUIRE NOW\"\n  useEffect(() => {\n    if (!initialChat || !initialChat.propertyId) return;\n    const ensureInquiry = async () => {\n      try {\n        setLoading(true);\n        // 1) Load current inquiries to avoid duplicates\n        let existing = chats;\n        if (!Array.isArray(existing) || existing.length === 0) {\n          try {\n            const res = await api.getTenantInquiries();\n            if (res && Array.isArray(res.inquiries)) {\n              // Reuse the same parser as in main load\n              const parser = inq => {\n                const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n                const chunks = [];\n                let last = 0;\n                let m;\n                while ((m = regex.exec(String(inq.message || ''))) !== null) {\n                  const txt = String(inq.message || '').slice(last, m.index);\n                  if (txt) chunks.push({\n                    text: txt,\n                    ts: null\n                  });\n                  chunks.push({\n                    text: null,\n                    ts: m[1] ? Number(m[1]) : null\n                  });\n                  last = m.index + m[0].length;\n                }\n                const tail = String(inq.message || '').slice(last);\n                if (tail) chunks.push({\n                  text: tail,\n                  ts: null\n                });\n                const out = [];\n                let pending = null;\n                const now = Date.now();\n                for (const c of chunks) {\n                  if (c.text === null) {\n                    pending = c.ts;\n                    continue;\n                  }\n                  // Clean the text - remove any separator prefixes\n                  let cleanText = c.text || '';\n                  cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                  cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                  // Skip empty messages after cleaning\n                  if (!cleanText) continue;\n\n                  // Filter out placeholder messages\n                  const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n                  if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n                    continue;\n                  }\n                  out.push({\n                    id: `${inq.id}-t-${out.length}`,\n                    sender: 'tenant',\n                    text: cleanText,\n                    time: new Date(pending || now).toLocaleTimeString()\n                  });\n                  pending = null;\n                }\n                if (inq.response_message) {\n                  // Clean manager reply too\n                  let cleanReply = String(inq.response_message || '').replace(/^---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                  cleanReply = cleanReply.replace(/\\s*---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                  if (cleanReply) {\n                    out.push({\n                      id: `${inq.id}-m`,\n                      sender: 'manager',\n                      text: cleanReply,\n                      time: new Date(inq.responded_at || now).toLocaleTimeString()\n                    });\n                  }\n                }\n                return out;\n              };\n              const mapped = res.inquiries.map(inquiry => {\n                var _inquiry$property_man3, _inquiry$property_man4, _inquiry$property5, _inquiry$property6, _inquiry$property7, _inquiry$property8;\n                return {\n                  id: inquiry.id,\n                  managerName: (((_inquiry$property_man3 = inquiry.property_manager) === null || _inquiry$property_man3 === void 0 ? void 0 : _inquiry$property_man3.first_name) || 'Property') + ' ' + (((_inquiry$property_man4 = inquiry.property_manager) === null || _inquiry$property_man4 === void 0 ? void 0 : _inquiry$property_man4.last_name) || 'Manager'),\n                  property: ((_inquiry$property5 = inquiry.property) === null || _inquiry$property5 === void 0 ? void 0 : _inquiry$property5.title) || ((_inquiry$property6 = inquiry.property) === null || _inquiry$property6 === void 0 ? void 0 : _inquiry$property6.building_name) || 'Property',\n                  propertyId: inquiry.property_id,\n                  unitId: inquiry.unit_id || inquiry.property_id,\n                  unitName: inquiry.unit_name || ((_inquiry$property7 = inquiry.property) === null || _inquiry$property7 === void 0 ? void 0 : _inquiry$property7.title) || ((_inquiry$property8 = inquiry.property) === null || _inquiry$property8 === void 0 ? void 0 : _inquiry$property8.building_name) || 'Property',\n                  avatar: 'ðŸ¢',\n                  status: inquiry.status,\n                  messages: parser(inquiry),\n                  inquiry\n                };\n              });\n              existing = mapped;\n              setChats(mapped);\n            }\n          } catch (_) {/* ignore load errors here */}\n        }\n\n        // 2) If an inquiry for this property already exists, just select it and pre-fill message\n        const match = (existing || []).find(c => Number(c.propertyId) === Number(initialChat.propertyId));\n        if (match) {\n          setSelectedChatId(match.id);\n\n          // Pre-fill message - use a more aggressive approach\n          const preFillMsg = match.messages && match.messages.length > 0 ? `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?` : `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n\n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = msg => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', {\n                bubbles: true\n              });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n          return;\n        }\n\n        // 3) Otherwise, create one - send a minimal placeholder message (required by backend) but don't display it\n        // Instead, pre-fill the text box with the actual message for user to send manually\n        const placeholderMessage = \"Inquiry started\"; // Minimal message required by backend\n        const response = await api.startTenantInquiry(initialChat.propertyId, placeholderMessage, initialChat.unitId || null);\n        if (response && response.inquiry) {\n          var _response$inquiry$pro, _response$inquiry$pro2, _response$inquiry$pro3, _response$inquiry$pro4, _response$inquiry$pro5, _response$inquiry$pro6;\n          const newChat = {\n            id: response.inquiry.id,\n            managerName: (((_response$inquiry$pro = response.inquiry.property_manager) === null || _response$inquiry$pro === void 0 ? void 0 : _response$inquiry$pro.first_name) || 'Property') + ' ' + (((_response$inquiry$pro2 = response.inquiry.property_manager) === null || _response$inquiry$pro2 === void 0 ? void 0 : _response$inquiry$pro2.last_name) || 'Manager'),\n            property: ((_response$inquiry$pro3 = response.inquiry.property) === null || _response$inquiry$pro3 === void 0 ? void 0 : _response$inquiry$pro3.title) || ((_response$inquiry$pro4 = response.inquiry.property) === null || _response$inquiry$pro4 === void 0 ? void 0 : _response$inquiry$pro4.building_name) || 'Property',\n            propertyId: response.inquiry.property_id,\n            unitId: response.inquiry.unit_id || response.inquiry.property_id,\n            unitName: initialChat.unitName || response.inquiry.unit_name || ((_response$inquiry$pro5 = response.inquiry.property) === null || _response$inquiry$pro5 === void 0 ? void 0 : _response$inquiry$pro5.title) || ((_response$inquiry$pro6 = response.inquiry.property) === null || _response$inquiry$pro6 === void 0 ? void 0 : _response$inquiry$pro6.building_name) || 'Property',\n            avatar: 'ðŸ¢',\n            status: response.inquiry.status,\n            // Don't show the placeholder message in chat - start with empty messages array\n            messages: [],\n            inquiry: response.inquiry\n          };\n\n          // Add to chats and select it\n          setChats(prev => {\n            // Remove any duplicate for this property\n            const filtered = prev.filter(c => Number(c.propertyId) !== Number(newChat.propertyId));\n            return [...filtered, newChat];\n          });\n          setSelectedChatId(newChat.id);\n\n          // Pre-fill message with the actual message user should send (ready-to-send, not auto-sent)\n          const preFillMsg = `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n\n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = msg => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', {\n                bubbles: true\n              });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n\n          // Clear first, then set the message multiple times\n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n\n          // Reload inquiries after a delay to ensure everything is in sync\n          setTimeout(async () => {\n            await loadInquiries();\n            // Ensure the chat is still selected and message is set after reload\n            setSelectedChatId(newChat.id);\n            setTimeout(() => forceSetMessage(preFillMsg), 100);\n          }, 300);\n        } else if (response && response.message === 'Inquiry already exists' && response.inquiry) {\n          var _response$inquiry$pro7, _response$inquiry$pro8, _response$inquiry$pro9, _response$inquiry$pro0, _response$inquiry$pro1, _response$inquiry$pro10;\n          // Select the existing inquiry\n          const existingChat = {\n            id: response.inquiry.id,\n            managerName: (((_response$inquiry$pro7 = response.inquiry.property_manager) === null || _response$inquiry$pro7 === void 0 ? void 0 : _response$inquiry$pro7.first_name) || 'Property') + ' ' + (((_response$inquiry$pro8 = response.inquiry.property_manager) === null || _response$inquiry$pro8 === void 0 ? void 0 : _response$inquiry$pro8.last_name) || 'Manager'),\n            property: ((_response$inquiry$pro9 = response.inquiry.property) === null || _response$inquiry$pro9 === void 0 ? void 0 : _response$inquiry$pro9.title) || ((_response$inquiry$pro0 = response.inquiry.property) === null || _response$inquiry$pro0 === void 0 ? void 0 : _response$inquiry$pro0.building_name) || 'Property',\n            propertyId: response.inquiry.property_id,\n            unitId: response.inquiry.unit_id || response.inquiry.property_id,\n            unitName: initialChat.unitName || response.inquiry.unit_name || ((_response$inquiry$pro1 = response.inquiry.property) === null || _response$inquiry$pro1 === void 0 ? void 0 : _response$inquiry$pro1.title) || ((_response$inquiry$pro10 = response.inquiry.property) === null || _response$inquiry$pro10 === void 0 ? void 0 : _response$inquiry$pro10.building_name) || 'Property',\n            avatar: 'ðŸ¢',\n            status: response.inquiry.status,\n            messages: function () {\n              const inq = response.inquiry;\n              // Use regex to properly split messages with timestamp support\n              const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n              const parts = [];\n              let lastIndex = 0;\n              let match;\n              let timestamps = [];\n              while ((match = regex.exec(String(inq.message || ''))) !== null) {\n                const textBefore = String(inq.message || '').slice(lastIndex, match.index);\n                if (textBefore.trim()) {\n                  parts.push({\n                    text: textBefore,\n                    ts: timestamps[parts.length] || null\n                  });\n                }\n                timestamps.push(match[1] ? Number(match[1]) : null);\n                lastIndex = match.index + match[0].length;\n              }\n              const tail = String(inq.message || '').slice(lastIndex);\n              if (tail.trim()) {\n                parts.push({\n                  text: tail,\n                  ts: timestamps[parts.length] || null\n                });\n              }\n              const nowMs = Date.now();\n              const startMs = nowMs - Math.max(0, parts.length - 1) * 60000;\n              return parts.map((p, idx) => {\n                // Clean the text - remove any separator prefixes\n                let cleanText = p.text || '';\n                cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                // Skip empty messages\n                if (!cleanText) return null;\n\n                // Filter out placeholder messages\n                const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n                if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n                  return null;\n                }\n                return {\n                  id: `${inq.id}-t-${idx}`,\n                  sender: 'tenant',\n                  text: cleanText,\n                  time: new Date(p.ts || startMs + idx * 60000).toLocaleTimeString()\n                };\n              }).filter(Boolean); // Remove null entries\n            }(),\n            inquiry: response.inquiry\n          };\n          setChats(prev => {\n            // Remove any duplicate for this property\n            const filtered = prev.filter(c => Number(c.propertyId) !== Number(existingChat.propertyId));\n            return [...filtered, existingChat];\n          });\n          setSelectedChatId(existingChat.id);\n\n          // Pre-fill message - use a more aggressive approach\n          const preFillMsg = existingChat.messages && existingChat.messages.length > 0 ? `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?` : `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n\n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = msg => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', {\n                bubbles: true\n              });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n        }\n      } catch (err) {\n        console.error('Failed to create inquiry:', err);\n        if (err.status === 401) {\n          setError('Please log in to create an inquiry.');\n        } else if (err.status === 500) {\n          setError('Server error. Please try again later.');\n        } else {\n          setError('Failed to create inquiry. Please try again.');\n        }\n      } finally {\n        setLoading(false);\n      }\n    };\n    ensureInquiry();\n  }, [initialChat]);\n  const selectedChat = useMemo(() => chats.find(c => c.id === selectedChatId) || null, [chats, selectedChatId]);\n\n  // Pre-fill message when a chat matching initialChat is selected (multiple attempts for reliability)\n  useEffect(() => {\n    if (!initialChat || !selectedChatId) return;\n\n    // Check if selected chat matches initialChat property\n    const matchedChat = chats.find(c => c.id === selectedChatId && Number(c.propertyId) === Number(initialChat.propertyId));\n    if (!matchedChat) return;\n\n    // Only pre-fill once per chat\n    if (preFilledMessageRef.current.has(selectedChatId)) return;\n\n    // Set message with multiple attempts to ensure it gets set\n    const attemptSetMessage = () => {\n      setMessage(current => {\n        // Only set if message is currently empty\n        if (current.trim()) return current;\n\n        // Determine message based on chat state\n        if (matchedChat.messages && matchedChat.messages.length > 0) {\n          preFilledMessageRef.current.add(selectedChatId);\n          return `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?`;\n        } else {\n          preFilledMessageRef.current.add(selectedChatId);\n          return `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n        }\n      });\n    };\n\n    // Try immediately\n    attemptSetMessage();\n\n    // Try again after a short delay as fallback\n    const timeout1 = setTimeout(attemptSetMessage, 100);\n    const timeout2 = setTimeout(attemptSetMessage, 300);\n    return () => {\n      clearTimeout(timeout1);\n      clearTimeout(timeout2);\n    };\n  }, [selectedChatId, chats, initialChat]);\n  const handleSendMessage = async () => {\n    if (!message.trim() || !selectedChat) return;\n    try {\n      setLoading(true);\n      const response = await api.sendTenantMessage(selectedChat.id, message.trim());\n      if (response && response.success) {\n        const messageText = message.trim();\n        const now = new Date();\n        // Optimistically add the message to the chat with correct time\n        setChats(prev => prev.map(c => c.id === selectedChat.id ? {\n          ...c,\n          messages: [...c.messages, {\n            id: `temp-${Date.now()}`,\n            sender: 'tenant',\n            text: messageText,\n            time: formatMessageTime(now),\n            created_at: now.toISOString()\n          }]\n        } : c));\n        setMessage('');\n\n        // Reload to get updated data from backend\n        await loadInquiries();\n\n        // Re-select the same chat after reload\n        setSelectedChatId(selectedChat.id);\n      } else {\n        setError('Failed to send message. Please try again.');\n      }\n    } catch (err) {\n      console.error('Failed to send message:', err);\n      setError('Failed to send message. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleFileSelect = e => {\n    const files = Array.from(e.target.files);\n    setSelectedFiles(files);\n  };\n  const handleFileUpload = async () => {\n    if (!selectedFiles.length || !selectedChat) return;\n    try {\n      setUploadingFiles(true);\n      const response = await api.uploadInquiryAttachments(selectedChat.id, selectedFiles);\n      if (response && response.attachments) {\n        console.log('Uploaded attachments:', response.attachments);\n        // Update attachments for this inquiry immediately\n        setAttachments(prev => {\n          const updated = {\n            ...prev,\n            [selectedChat.id]: [...(prev[selectedChat.id] || []), ...response.attachments]\n          };\n          console.log('Updated attachments state:', updated);\n          return updated;\n        });\n        setSelectedFiles([]);\n        if (fileInputRef.current) fileInputRef.current.value = '';\n\n        // Reload to get updated data and ensure everything is in sync\n        await loadInquiries();\n\n        // Re-select the same chat after reload\n        setSelectedChatId(selectedChat.id);\n      } else {\n        setError('Failed to upload files. Please try again.');\n      }\n    } catch (err) {\n      console.error('Failed to upload files:', err);\n      setError('Failed to upload files. Please try again.');\n    } finally {\n      setUploadingFiles(false);\n    }\n  };\n  const handleDownloadAttachment = async (attachmentId, fileName) => {\n    try {\n      const blob = await api.downloadInquiryAttachment(attachmentId);\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = fileName;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n    } catch (err) {\n      console.error('Failed to download attachment:', err);\n      setError('Failed to download file. Please try again.');\n    }\n  };\n  const handleDeleteAttachment = async (attachmentId, inquiryId) => {\n    if (!window.confirm('Are you sure you want to delete this file?')) return;\n    try {\n      await api.deleteInquiryAttachment(attachmentId);\n      setAttachments(prev => ({\n        ...prev,\n        [inquiryId]: (prev[inquiryId] || []).filter(att => att.id !== attachmentId)\n      }));\n\n      // Reload to get updated data\n      await loadInquiries();\n    } catch (err) {\n      console.error('Failed to delete attachment:', err);\n      setError('Failed to delete file. Please try again.');\n    }\n  };\n  const handleKeyPress = e => {\n    if (e.key === 'Enter') handleSendMessage();\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-3 z-50\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-xl w-full max-w-6xl max-h-[90vh] shadow-2xl overflow-hidden\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: onClose,\n            className: \"w-9 h-9 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-all duration-300 shadow-lg\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-4 h-4 text-white\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M15 19l-7-7 7-7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 863,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 862,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 858,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n              className: \"text-lg font-black text-black\",\n              children: \"My Property Inquiries\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 867,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-xs text-gray-500\",\n              children: \"Chat with property managers about available properties\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 868,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 866,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 857,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 856,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-red-50 border-l-4 border-red-400 p-4 mx-4 mt-2\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ml-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm text-red-700\",\n              children: error\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 878,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setError(null),\n              className: \"text-xs text-red-600 underline mt-1\",\n              children: \"Dismiss\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 879,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 877,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 876,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 875,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex h-[calc(90vh-72px)]\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-80 border-r border-gray-200 bg-gray-50\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex border-b border-gray-200\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {},\n              className: `flex-1 py-3 px-4 text-sm font-medium transition-colors ${'bg-white text-black border-b-2 border-black'}`,\n              children: \"Active Chats\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 896,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {},\n              className: `flex-1 py-3 px-4 text-sm font-medium transition-colors ${'text-gray-600 hover:text-black hover:bg-gray-100'}`,\n              children: \"New Properties\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 904,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 895,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"relative\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\",\n                children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"h-4 w-4 text-gray-400\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: 2,\n                    d: \"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 919,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 918,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 917,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                placeholder: \"Search chats...\",\n                className: \"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-sm\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 922,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 916,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 915,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 overflow-y-auto\",\n            children: loading && chats.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-4 text-center\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"animate-spin rounded-full h-8 w-8 border-b-2 border-black mx-auto\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 935,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm text-gray-500 mt-2\",\n                children: \"Loading inquiries...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 936,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 934,\n              columnNumber: 17\n            }, this) :\n            /*#__PURE__*/\n            /* Active Chats */\n            _jsxDEV(\"div\", {\n              className: \"space-y-1 px-2\",\n              children: chats.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"p-4 text-sm text-gray-500\",\n                children: \"No conversations yet. Start an inquiry from a unit to chat with a manager.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 942,\n                columnNumber: 19\n              }, this) : chats.map(chat => {\n                var _chat$messages, _chat$messages2;\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => setSelectedChatId(chat.id),\n                  className: `p-3 rounded-lg cursor-pointer transition-colors ${selectedChatId === chat.id ? 'bg-gray-200' : 'hover:bg-gray-100'}`,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"flex items-center space-x-3\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"relative\",\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\",\n                        children: /*#__PURE__*/_jsxDEV(\"span\", {\n                          className: \"text-sm font-medium text-blue-600\",\n                          children: chat.avatar\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 955,\n                          columnNumber: 29\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 954,\n                        columnNumber: 27\n                      }, this), chat.status === 'online' && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 958,\n                        columnNumber: 29\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 953,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"flex-1 min-w-0\",\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"flex items-center justify-between\",\n                        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                          className: \"text-sm font-medium text-gray-900 truncate\",\n                          children: chat.managerName\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 963,\n                          columnNumber: 29\n                        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                          className: \"text-xs text-gray-500\",\n                          children: (_chat$messages = chat.messages[chat.messages.length - 1]) === null || _chat$messages === void 0 ? void 0 : _chat$messages.time\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 964,\n                          columnNumber: 29\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 962,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                        className: \"text-xs text-gray-600 truncate\",\n                        children: chat.property\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 966,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                        className: \"text-xs text-gray-500 truncate\",\n                        children: String(((_chat$messages2 = chat.messages[chat.messages.length - 1]) === null || _chat$messages2 === void 0 ? void 0 : _chat$messages2.text) || '').replace(/---\\s*Manager Reply\\s*\\[\\d{10,}\\]\\s*---/g, '').replace(/---\\s*New Message\\s*(?:\\[\\d{10,}\\])?\\s*---/g, '')\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 967,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 961,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 952,\n                    columnNumber: 23\n                  }, this)\n                }, chat.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 945,\n                  columnNumber: 21\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 940,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 931,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 893,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1 flex flex-col bg-white\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-between p-4 border-b border-gray-200\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"relative\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\",\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-sm font-medium text-blue-600\",\n                    children: (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.avatar) || 'PM'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 989,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 988,\n                  columnNumber: 19\n                }, this), (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.status) === 'online' && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 994,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 987,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                  className: \"text-sm font-medium text-gray-900\",\n                  children: (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.managerName) || 'Property Manager'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 998,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-xs text-gray-500\",\n                  children: (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.unitName) || (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.property) || 'Property'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1001,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 997,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 986,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 985,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 overflow-y-auto p-4 space-y-4\",\n            children: [(() => {\n              const unmatchedAttachments = getUnmatchedAttachments(selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.id, (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.messages) || []);\n              console.log('Unmatched attachments for inquiry', selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.id, ':', unmatchedAttachments);\n              console.log('All attachments for inquiry', selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.id, ':', attachments[selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.id]);\n              const allItems = [];\n\n              // Add all messages\n              ((selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.messages) || []).forEach(msg => {\n                allItems.push({\n                  type: 'message',\n                  data: msg,\n                  timestamp: msg.created_at ? new Date(msg.created_at).getTime() : 0\n                });\n              });\n\n              // Add unmatched attachments as virtual messages\n              unmatchedAttachments.forEach(att => {\n                allItems.push({\n                  type: 'attachment',\n                  data: att,\n                  timestamp: att.created_at ? new Date(att.created_at).getTime() : 0\n                });\n              });\n\n              // Sort by timestamp\n              allItems.sort((a, b) => a.timestamp - b.timestamp);\n              return allItems.map((item, idx) => {\n                if (item.type === 'attachment') {\n                  var _currentChat$inquiry;\n                  const att = item.data;\n                  // Determine sender based on uploaded_by\n                  const currentChat = chats.find(c => c.id === (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.id));\n                  const isTenant = (currentChat === null || currentChat === void 0 ? void 0 : (_currentChat$inquiry = currentChat.inquiry) === null || _currentChat$inquiry === void 0 ? void 0 : _currentChat$inquiry.tenant_id) && att.uploaded_by && String(att.uploaded_by) === String(currentChat.inquiry.tenant_id);\n                  const sender = isTenant ? 'tenant' : 'manager';\n                  return /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `flex ${sender === 'tenant' ? 'justify-end' : 'justify-start'}`,\n                    children: /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: `max-w-xs lg:max-w-md rounded-lg overflow-hidden ${sender === 'tenant' ? 'bg-black text-white' : 'bg-gray-200 text-gray-900'}`,\n                      children: [(isImage(att.mime_type, att.file_type) || isVideo(att.mime_type, att.file_type)) && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"relative\",\n                        children: isImage(att.mime_type, att.file_type) ? /*#__PURE__*/_jsxDEV(MediaDisplay, {\n                          attachment: att,\n                          type: \"image\",\n                          getMediaUrl: getMediaUrl,\n                          getAttachmentUrl: getAttachmentUrl,\n                          onImageClick: setLightboxImage\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1060,\n                          columnNumber: 41\n                        }, this) : /*#__PURE__*/_jsxDEV(MediaDisplay, {\n                          attachment: att,\n                          type: \"video\",\n                          getMediaUrl: getMediaUrl,\n                          getAttachmentUrl: getAttachmentUrl,\n                          onImageClick: setLightboxImage\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1068,\n                          columnNumber: 41\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1058,\n                        columnNumber: 29\n                      }, this), !isImage(att.mime_type, att.file_type) && !isVideo(att.mime_type, att.file_type) && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"px-4 pt-2 pb-2\",\n                        children: /*#__PURE__*/_jsxDEV(\"div\", {\n                          className: `flex items-center space-x-2 p-2 rounded ${sender === 'tenant' ? 'bg-gray-800' : 'bg-gray-300'}`,\n                          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                            className: \"w-5 h-5 flex-shrink-0\",\n                            fill: \"none\",\n                            stroke: \"currentColor\",\n                            viewBox: \"0 0 24 24\",\n                            children: /*#__PURE__*/_jsxDEV(\"path\", {\n                              strokeLinecap: \"round\",\n                              strokeLinejoin: \"round\",\n                              strokeWidth: 2,\n                              d: \"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1090,\n                              columnNumber: 35\n                            }, this)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1089,\n                            columnNumber: 33\n                          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                            className: \"flex-1 min-w-0\",\n                            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                              className: \"text-xs font-medium truncate\",\n                              children: att.file_name\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1093,\n                              columnNumber: 35\n                            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                              className: \"text-xs opacity-75\",\n                              children: [(att.file_size / 1024).toFixed(1), \" KB\"]\n                            }, void 0, true, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1094,\n                              columnNumber: 35\n                            }, this)]\n                          }, void 0, true, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1092,\n                            columnNumber: 33\n                          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                            onClick: () => handleDownloadAttachment(att.id, att.file_name),\n                            className: \"p-1 hover:opacity-75 transition-opacity\",\n                            title: \"Download\",\n                            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                              className: \"w-4 h-4\",\n                              fill: \"none\",\n                              stroke: \"currentColor\",\n                              viewBox: \"0 0 24 24\",\n                              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                                strokeLinecap: \"round\",\n                                strokeLinejoin: \"round\",\n                                strokeWidth: 2,\n                                d: \"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"\n                              }, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 1104,\n                                columnNumber: 37\n                              }, this)\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1103,\n                              columnNumber: 35\n                            }, this)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1098,\n                            columnNumber: 33\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1082,\n                          columnNumber: 31\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1081,\n                        columnNumber: 29\n                      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"px-4 pb-2\",\n                        children: /*#__PURE__*/_jsxDEV(\"p\", {\n                          className: `text-xs ${sender === 'tenant' ? 'text-gray-300' : 'text-gray-500'}`,\n                          children: formatMessageTime(att.created_at)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1113,\n                          columnNumber: 29\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1112,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1049,\n                      columnNumber: 25\n                    }, this)\n                  }, `att-${att.id}`, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1045,\n                    columnNumber: 23\n                  }, this);\n                } else {\n                  // Regular message\n                  const msg = item.data;\n                  const messageAttachments = getMessageAttachments(msg, selectedChat.id);\n                  const hasAttachments = messageAttachments.length > 0;\n                  const hasText = msg.text && msg.text.trim().length > 0;\n                  return /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `flex ${msg.sender === 'tenant' ? 'justify-end' : 'justify-start'}`,\n                    children: /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: `max-w-xs lg:max-w-md rounded-lg overflow-hidden ${msg.sender === 'tenant' ? 'bg-black text-white' : 'bg-gray-200 text-gray-900'}`,\n                      children: [hasAttachments && messageAttachments.filter(att => isImage(att.mime_type, att.file_type) || isVideo(att.mime_type, att.file_type)).length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"space-y-1\",\n                        children: messageAttachments.filter(att => isImage(att.mime_type, att.file_type) || isVideo(att.mime_type, att.file_type)).map(att => /*#__PURE__*/_jsxDEV(\"div\", {\n                          className: \"relative\",\n                          children: isImage(att.mime_type, att.file_type) ? /*#__PURE__*/_jsxDEV(MediaDisplay, {\n                            attachment: att,\n                            type: \"image\",\n                            getMediaUrl: getMediaUrl,\n                            getAttachmentUrl: getAttachmentUrl,\n                            onImageClick: setLightboxImage\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1147,\n                            columnNumber: 33\n                          }, this) : /*#__PURE__*/_jsxDEV(MediaDisplay, {\n                            attachment: att,\n                            type: \"video\",\n                            getMediaUrl: getMediaUrl,\n                            getAttachmentUrl: getAttachmentUrl,\n                            onImageClick: setLightboxImage\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1155,\n                            columnNumber: 33\n                          }, this)\n                        }, att.id, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1145,\n                          columnNumber: 35\n                        }, this))\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1141,\n                        columnNumber: 29\n                      }, this), hasText && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"px-4 py-2\",\n                        children: /*#__PURE__*/_jsxDEV(\"p\", {\n                          className: \"text-sm whitespace-pre-wrap break-words\",\n                          children: msg.text\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1171,\n                          columnNumber: 31\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1170,\n                        columnNumber: 29\n                      }, this), hasAttachments && messageAttachments.filter(att => !isImage(att.mime_type, att.file_type) && !isVideo(att.mime_type, att.file_type)).length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: `px-4 ${hasText ? 'pt-2' : 'pt-2'} pb-2 space-y-2`,\n                        children: messageAttachments.filter(att => !isImage(att.mime_type, att.file_type) && !isVideo(att.mime_type, att.file_type)).map(att => /*#__PURE__*/_jsxDEV(\"div\", {\n                          className: `flex items-center space-x-2 p-2 rounded ${msg.sender === 'tenant' ? 'bg-gray-800' : 'bg-gray-300'}`,\n                          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                            className: \"w-5 h-5 flex-shrink-0\",\n                            fill: \"none\",\n                            stroke: \"currentColor\",\n                            viewBox: \"0 0 24 24\",\n                            children: /*#__PURE__*/_jsxDEV(\"path\", {\n                              strokeLinecap: \"round\",\n                              strokeLinejoin: \"round\",\n                              strokeWidth: 2,\n                              d: \"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1190,\n                              columnNumber: 39\n                            }, this)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1189,\n                            columnNumber: 37\n                          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                            className: \"flex-1 min-w-0\",\n                            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                              className: \"text-xs font-medium truncate\",\n                              children: att.file_name\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1193,\n                              columnNumber: 39\n                            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                              className: \"text-xs opacity-75\",\n                              children: [(att.file_size / 1024).toFixed(1), \" KB\"]\n                            }, void 0, true, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1194,\n                              columnNumber: 39\n                            }, this)]\n                          }, void 0, true, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1192,\n                            columnNumber: 37\n                          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                            onClick: () => handleDownloadAttachment(att.id, att.file_name),\n                            className: \"p-1 hover:opacity-75 transition-opacity\",\n                            title: \"Download\",\n                            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                              className: \"w-4 h-4\",\n                              fill: \"none\",\n                              stroke: \"currentColor\",\n                              viewBox: \"0 0 24 24\",\n                              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                                strokeLinecap: \"round\",\n                                strokeLinejoin: \"round\",\n                                strokeWidth: 2,\n                                d: \"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"\n                              }, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 1204,\n                                columnNumber: 41\n                              }, this)\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1203,\n                              columnNumber: 39\n                            }, this)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1198,\n                            columnNumber: 37\n                          }, this)]\n                        }, att.id, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1181,\n                          columnNumber: 35\n                        }, this))\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1177,\n                        columnNumber: 29\n                      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: `px-4 pb-2 ${hasAttachments && !hasText ? 'pt-2' : ''}`,\n                        children: /*#__PURE__*/_jsxDEV(\"p\", {\n                          className: `text-xs ${msg.sender === 'tenant' ? 'text-gray-300' : 'text-gray-500'}`,\n                          children: msg.time\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1214,\n                          columnNumber: 29\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1213,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1132,\n                      columnNumber: 25\n                    }, this)\n                  }, msg.id, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1128,\n                    columnNumber: 23\n                  }, this);\n                }\n              });\n            })(), (!(selectedChat !== null && selectedChat !== void 0 && selectedChat.messages) || selectedChat.messages.length === 0) && (!attachments[selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.id] || attachments[selectedChat.id].length === 0) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-center text-gray-500 py-8\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"No messages yet. Start the conversation!\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1230,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1229,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1009,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4 border-t border-gray-200\",\n            children: [selectedFiles.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-2 flex flex-wrap gap-2\",\n              children: [selectedFiles.map((file, idx) => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center space-x-2 bg-gray-100 px-3 py-1 rounded-lg text-sm\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-gray-700\",\n                  children: file.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1243,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => setSelectedFiles(prev => prev.filter((_, i) => i !== idx)),\n                  className: \"text-red-600 hover:text-red-800\",\n                  children: \"\\xD7\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1244,\n                  columnNumber: 23\n                }, this)]\n              }, idx, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1242,\n                columnNumber: 21\n              }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: handleFileUpload,\n                disabled: uploadingFiles,\n                className: \"bg-blue-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50\",\n                children: uploadingFiles ? 'Uploading...' : 'Upload'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1252,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1240,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                ref: fileInputRef,\n                type: \"file\",\n                multiple: true,\n                accept: \"image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx\",\n                onChange: handleFileSelect,\n                className: \"hidden\",\n                id: \"file-input\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1263,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: \"file-input\",\n                className: \"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors cursor-pointer\",\n                children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-5 h-5 text-gray-600\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: 2,\n                    d: \"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1277,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1276,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1272,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                ref: messageInputRef,\n                type: \"text\",\n                value: message || '',\n                onChange: e => setMessage(e.target.value),\n                onKeyPress: handleKeyPress,\n                placeholder: \"Type your message to the property manager...\",\n                className: \"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-black placeholder-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1280,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: handleSendMessage,\n                disabled: loading || !message.trim(),\n                className: \"w-10 h-10 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\",\n                children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1295,\n                  columnNumber: 21\n                }, this) : /*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-5 h-5 text-white\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: 2,\n                    d: \"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1298,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1297,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1289,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1262,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-xs text-gray-500 mt-2 text-center\",\n              children: [\"You're chatting with the property manager about \", (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.unitName) || (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.property) || 'this unit']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1303,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1237,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 983,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 891,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 854,\n      columnNumber: 7\n    }, this), lightboxImage && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 z-[200] bg-black bg-opacity-90 flex items-center justify-center p-4\",\n      onClick: () => setLightboxImage(null),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative max-w-7xl max-h-full w-full h-full flex items-center justify-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setLightboxImage(null),\n          className: \"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors z-10\",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-8 h-8\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M6 18L18 6M6 6l12 12\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1323,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1322,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1318,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: lightboxImage.url,\n          alt: lightboxImage.fileName,\n          className: \"max-w-full max-h-full object-contain\",\n          onClick: e => e.stopPropagation()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1326,\n          columnNumber: 13\n        }, this), lightboxImage.fileName && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-75 text-white px-4 py-2 rounded-lg text-sm\",\n          children: lightboxImage.fileName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1333,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1317,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1313,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 853,\n    columnNumber: 5\n  }, this);\n};\n_s2(Inquiries, \"LWTVeCxkVIIXuw/cdRFoMokRprE=\");\n_c = Inquiries;\nexport default Inquiries;\nvar _c;\n$RefreshReg$(_c, \"Inquiries\");","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","api","jsxDEV","_jsxDEV","Inquiries","onClose","initialChat","_s2","_s","$RefreshSig$","message","setMessage","chats","setChats","selectedChatId","setSelectedChatId","loading","setLoading","error","setError","uploadingFiles","setUploadingFiles","selectedFiles","setSelectedFiles","attachments","setAttachments","hydratedRef","preFilledMessageRef","Set","messageInputRef","fileInputRef","lightboxImage","setLightboxImage","MediaDisplay","attachment","type","getMediaUrl","getAttachmentUrl","onImageClick","url","setUrl","isMounted","console","log","id","file_name","mime_type","then","mediaUrl","catch","err","window","URL","revokeObjectURL","className","children","fileName","_jsxFileName","lineNumber","columnNumber","src","alt","onClick","onError","controls","attachmentId","process","env","REACT_APP_API_URL","mediaUrls","setMediaUrls","blob","downloadInquiryAttachment","Blob","createObjectURL","prev","isImage","mimeType","fileType","startsWith","includes","toLowerCase","isVideo","getMessageAttachments","inquiryId","created_at","messageTime","Date","getTime","filter","att","attTime","Math","abs","getUnmatchedAttachments","messages","length","matchedAttachmentIds","forEach","msg","messageAttachments","add","has","formatMessageTime","dateString","now","toLocaleTimeString","hour","minute","date","normalizedString","trim","endsWith","isNaN","warn","loadInquiries","accessToken","localStorage","getItem","response","getTenantInquiries","inquiries","toMessages","inq","newFormatMsgs","Array","isArray","push","sender","sender_id","tenant_id","text","time","oldFormatMsgs","regex","chunks","lastIndex","match","exec","String","ts","Number","slice","index","tail","parts","pendingTs","c","p","idx","cleanText","replace","placeholderPatterns","some","pattern","test","toISOString","response_message","mSep","mSrc","mParts","mLast","mm","txt","mTail","mPending","part","allMsgs","uniqueMsgs","seenTexts","textKey","sort","a","b","timeA","timeB","mapped","map","inquiry","_inquiry$property_man","_inquiry$property_man2","_inquiry$property","_inquiry$property2","_inquiry$property3","_inquiry$property4","managerName","property_manager","first_name","last_name","property","title","building_name","propertyId","property_id","unitId","unit_id","unitName","unit_name","avatar","status","dedup","seen","key","chat","attData","getInquiryAttachments","current","setItem","JSON","stringify","_","ensureInquiry","existing","res","parser","last","m","out","pending","cleanReply","responded_at","_inquiry$property_man3","_inquiry$property_man4","_inquiry$property5","_inquiry$property6","_inquiry$property7","_inquiry$property8","find","preFillMsg","forceSetMessage","value","event","Event","bubbles","dispatchEvent","setTimeout","placeholderMessage","startTenantInquiry","_response$inquiry$pro","_response$inquiry$pro2","_response$inquiry$pro3","_response$inquiry$pro4","_response$inquiry$pro5","_response$inquiry$pro6","newChat","filtered","_response$inquiry$pro7","_response$inquiry$pro8","_response$inquiry$pro9","_response$inquiry$pro0","_response$inquiry$pro1","_response$inquiry$pro10","existingChat","timestamps","textBefore","nowMs","startMs","max","Boolean","selectedChat","matchedChat","attemptSetMessage","timeout1","timeout2","clearTimeout","handleSendMessage","sendTenantMessage","success","messageText","handleFileSelect","e","files","from","target","handleFileUpload","uploadInquiryAttachments","updated","handleDownloadAttachment","document","createElement","href","download","body","appendChild","click","removeChild","handleDeleteAttachment","confirm","deleteInquiryAttachment","handleKeyPress","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","placeholder","_chat$messages","_chat$messages2","unmatchedAttachments","allItems","data","timestamp","item","_currentChat$inquiry","currentChat","isTenant","uploaded_by","file_type","file_size","toFixed","hasAttachments","hasText","file","name","i","disabled","ref","multiple","accept","onChange","htmlFor","onKeyPress","stopPropagation","_c","$RefreshReg$"],"sources":["C:/Users/Lenovo/OneDrive/Desktop/Capstone-Project-jun/main-domain/frontend/src/components/Tenants/Inquiries.js"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport api from '../../services/api';\n\n// Props:\n// - onClose(): close modal\n// - initialChat: { id?, managerName, property, unitId, propertyId }\nconst Inquiries = ({ onClose, initialChat = null }) => {\n  const [message, setMessage] = useState('');\n  const [chats, setChats] = useState([]); // [{id, managerName, property, avatar, status, messages: [{id, sender, text, time}]}]\n  const [selectedChatId, setSelectedChatId] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [uploadingFiles, setUploadingFiles] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState([]);\n  const [attachments, setAttachments] = useState({}); // {inquiryId: [attachments]}\n  const hydratedRef = useRef(false);\n  const preFilledMessageRef = useRef(new Set()); // Track which chats have had messages pre-filled\n  const messageInputRef = useRef(null); // Reference to the message input element\n  const fileInputRef = useRef(null);\n  const [lightboxImage, setLightboxImage] = useState(null); // {url, fileName} for lightbox modal\n\n  // Media Display Component\n  const MediaDisplay = ({ attachment, type, getMediaUrl, getAttachmentUrl, onImageClick }) => {\n    const [url, setUrl] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(false);\n\n    useEffect(() => {\n      let isMounted = true;\n      setLoading(true);\n      setError(false);\n      \n      console.log('MediaDisplay: Loading attachment', attachment.id, attachment.file_name, attachment.mime_type);\n      \n      getMediaUrl(attachment.id).then(mediaUrl => {\n        if (isMounted) {\n          if (mediaUrl) {\n            console.log('MediaDisplay: Successfully loaded media URL for', attachment.id);\n            setUrl(mediaUrl);\n            setLoading(false);\n          } else {\n            console.error('MediaDisplay: Failed to get media URL for attachment:', attachment.id);\n            setError(true);\n            setLoading(false);\n          }\n        }\n      }).catch(err => {\n        if (isMounted) {\n          console.error('MediaDisplay: Error loading media:', err, attachment);\n          setError(true);\n          setLoading(false);\n        }\n      });\n      \n      return () => {\n        isMounted = false;\n        if (url) {\n          window.URL.revokeObjectURL(url);\n        }\n      };\n    }, [attachment.id]);\n\n    if (error) return null;\n    if (loading) {\n      return (\n        <div className=\"w-full h-48 bg-gray-300 flex items-center justify-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-600\"></div>\n        </div>\n      );\n    }\n    if (!url) return null;\n\n    if (type === 'image') {\n      return (\n        <img\n          src={url}\n          alt={attachment.file_name}\n          className=\"w-full h-auto max-h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity\"\n          onClick={() => onImageClick && onImageClick({ url, fileName: attachment.file_name })}\n          onError={() => setError(true)}\n        />\n      );\n    } else {\n      return (\n        <video\n          src={url}\n          controls\n          className=\"w-full h-auto max-h-64 object-cover\"\n          onError={() => setError(true)}\n        >\n          Your browser does not support the video tag.\n        </video>\n      );\n    }\n  };\n\n  // Helper to get attachment URL (for download)\n  const getAttachmentUrl = (attachmentId) => {\n    return `${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/inquiries/attachments/${attachmentId}`;\n  };\n\n  // Helper to get authenticated image/video URL\n  const [mediaUrls, setMediaUrls] = useState({}); // Cache for blob URLs\n  const getMediaUrl = async (attachmentId) => {\n    if (mediaUrls[attachmentId]) return mediaUrls[attachmentId];\n    try {\n      const blob = await api.downloadInquiryAttachment(attachmentId);\n      \n      // Verify that we got a Blob object\n      if (!blob || !(blob instanceof Blob)) {\n        console.error('Invalid blob response:', blob);\n        return null;\n      }\n      \n      const url = window.URL.createObjectURL(blob);\n      setMediaUrls(prev => ({ ...prev, [attachmentId]: url }));\n      return url;\n    } catch (error) {\n      console.error('Failed to load media:', error);\n      return null;\n    }\n  };\n\n  // Helper to check if file is image\n  const isImage = (mimeType, fileType) => {\n    return (mimeType && mimeType.startsWith('image/')) || \n           (fileType && ['image', 'jpg', 'jpeg', 'png', 'gif', 'webp'].includes(fileType.toLowerCase()));\n  };\n\n  // Helper to check if file is video\n  const isVideo = (mimeType, fileType) => {\n    return (mimeType && mimeType.startsWith('video/')) || \n           (fileType && ['video', 'mp4', 'mov', 'avi', 'webm'].includes(fileType.toLowerCase()));\n  };\n\n  // Helper to get attachments for a specific message (by matching timestamp within 30 seconds)\n  const getMessageAttachments = (message, inquiryId) => {\n    if (!attachments[inquiryId] || !message.created_at) return [];\n    const messageTime = new Date(message.created_at).getTime();\n    return attachments[inquiryId].filter(att => {\n      if (!att.created_at) return false;\n      const attTime = new Date(att.created_at).getTime();\n      // Match attachments uploaded within 30 seconds of message (more flexible)\n      return Math.abs(messageTime - attTime) < 30000;\n    });\n  };\n\n  // Helper to get unmatched attachments (attachments that don't belong to any message)\n  const getUnmatchedAttachments = (inquiryId, messages) => {\n    if (!attachments[inquiryId] || !messages || messages.length === 0) {\n      // If no messages, show all attachments\n      return attachments[inquiryId] || [];\n    }\n    \n    const matchedAttachmentIds = new Set();\n    messages.forEach(msg => {\n      if (msg.created_at) {\n        const messageAttachments = getMessageAttachments(msg, inquiryId);\n        messageAttachments.forEach(att => matchedAttachmentIds.add(att.id));\n      }\n    });\n    \n    // Return attachments that weren't matched to any message\n    return (attachments[inquiryId] || []).filter(att => !matchedAttachmentIds.has(att.id));\n  };\n\n  // Helper function to format time consistently\n  const formatMessageTime = (dateString) => {\n    if (!dateString) {\n      const now = new Date();\n      return now.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });\n    }\n    try {\n      let date;\n      if (dateString instanceof Date) {\n        date = dateString;\n      } else if (typeof dateString === 'string') {\n        // If the string doesn't have timezone info, assume it's UTC from the backend\n        // Backend sends ISO format which may or may not have 'Z' suffix\n        let normalizedString = dateString.trim();\n        if (!normalizedString.endsWith('Z') && !normalizedString.includes('+') && !normalizedString.includes('-', 10)) {\n          // No timezone indicator, assume UTC\n          normalizedString = normalizedString.endsWith('Z') ? normalizedString : normalizedString + 'Z';\n        }\n        date = new Date(normalizedString);\n      } else if (typeof dateString === 'number') {\n        // Timestamp in milliseconds\n        date = new Date(dateString);\n      } else {\n        date = new Date(dateString);\n      }\n      \n      if (isNaN(date.getTime())) {\n        console.warn('Invalid date:', dateString);\n        return new Date().toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });\n      }\n      \n      // Format in local timezone\n      return date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });\n    } catch (error) {\n      console.error('Error formatting time:', error, dateString);\n      return new Date().toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });\n    }\n  };\n\n  // Load inquiries from backend API\n  const loadInquiries = async () => {\n    try {\n      setLoading(true); \n      setError(null);\n      \n      // Check if user is authenticated\n      const accessToken = localStorage.getItem('access_token') || localStorage.getItem('token');\n      if (!accessToken) {\n        setError('Please log in to view your inquiries.');\n        setLoading(false);\n        return;\n      }\n      \n      const response = await api.getTenantInquiries();\n      if (response && response.inquiries) {\n        // Helper: explode concatenated text (tenant + manager) into chronological bubbles with embedded timestamps\n        const toMessages = (inq) => {\n          // Start with messages from inquiry_messages table if available (new format)\n          const newFormatMsgs = [];\n          if (inq.messages && Array.isArray(inq.messages) && inq.messages.length > 0) {\n            inq.messages.forEach(msg => {\n              newFormatMsgs.push({\n                id: `msg-${msg.id}`,\n                sender: msg.sender || (msg.sender_id === inq.tenant_id ? 'tenant' : 'manager'),\n                text: msg.message || msg.text || '',\n                time: formatMessageTime(msg.created_at),\n                created_at: msg.created_at\n              });\n            });\n          }\n          \n          // Parse old format messages (for backward compatibility and initial messages)\n          const oldFormatMsgs = [];\n          \n          // Fallback: Parse old format messages (for backward compatibility)\n          const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n          const chunks = [];\n          let lastIndex = 0;\n          let match;\n          while ((match = regex.exec(String(inq.message || ''))) !== null) {\n            const ts = match[1] ? Number(match[1]) : null;\n            const text = String(inq.message || '').slice(lastIndex, match.index);\n            if (text) chunks.push({ text, ts: null });\n            lastIndex = match.index + match[0].length;\n            chunks.push({ text: null, ts });\n          }\n          const tail = String(inq.message || '').slice(lastIndex);\n          if (tail) chunks.push({ text: tail, ts: null });\n\n          // Merge markers (ts) with following text blocks\n          const parts = [];\n          let pendingTs = null;\n          for (const c of chunks) {\n            if (c.text === null && c.ts) {\n              pendingTs = c.ts;\n            } else if (c.text) {\n              parts.push({ text: c.text, ts: pendingTs });\n              pendingTs = null;\n            }\n          }\n\n          parts.forEach((p, idx) => {\n            let cleanText = p.text || '';\n            cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n            cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n            if (!cleanText) return;\n            \n            const placeholderPatterns = [\n              /^inquiry\\s+started$/i,\n              /^placeholder$/i,\n              /^init$/i\n            ];\n            if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n              return;\n            }\n            \n            oldFormatMsgs.push({\n              id: `${inq.id}-t-${idx}`,\n              sender: 'tenant',\n              text: cleanText,\n              time: formatMessageTime(p.ts ? new Date(p.ts) : new Date()),\n              created_at: p.ts ? new Date(p.ts).toISOString() : new Date().toISOString()\n            });\n          });\n\n          // Also explode manager replies stored in response_message (old format)\n          if (inq.response_message) {\n            const mSep = /\\n\\n--- Manager Reply \\[(\\d{10,})\\] ---\\n/g;\n            const mSrc = String(inq.response_message || '');\n            const mParts = []; let mLast = 0; let mm;\n            while ((mm = mSep.exec(mSrc)) !== null) {\n              const txt = mSrc.slice(mLast, mm.index);\n              if (txt) mParts.push({ text: txt, ts: null });\n              mParts.push({ text: null, ts: mm[1] ? Number(mm[1]) : null });\n              mLast = mm.index + mm[0].length;\n            }\n            const mTail = mSrc.slice(mLast); if (mTail) mParts.push({ text: mTail, ts: null });\n            let mPending = null; const now = Date.now();\n            for (const part of mParts) {\n              if (part.text === null) { mPending = part.ts; continue; }\n              let cleanText = part.text || '';\n              cleanText = cleanText.replace(/^---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n              cleanText = cleanText.replace(/\\s*---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n              if (!cleanText) continue;\n              \n              oldFormatMsgs.push({ \n                id: `${inq.id}-m-${oldFormatMsgs.length}`, \n                sender: 'manager', \n                text: cleanText, \n                time: formatMessageTime(mPending ? new Date(mPending) : new Date(now)),\n                created_at: mPending ? new Date(mPending).toISOString() : new Date(now).toISOString()\n              });\n              mPending = null;\n            }\n          }\n          \n          // Merge new format and old format messages, removing duplicates\n          const allMsgs = [...newFormatMsgs, ...oldFormatMsgs];\n          \n          // Remove duplicates based on text content and sender\n          const uniqueMsgs = [];\n          const seenTexts = new Set();\n          for (const msg of allMsgs) {\n            const textKey = `${msg.sender}-${msg.text}`;\n            if (!seenTexts.has(textKey)) {\n              seenTexts.add(textKey);\n              uniqueMsgs.push(msg);\n            }\n          }\n          \n          // Sort by created_at timestamp or time\n          uniqueMsgs.sort((a, b) => {\n            const timeA = a.created_at ? new Date(a.created_at).getTime() : \n                         (a.time ? new Date(`2000-01-01 ${a.time}`).getTime() : 0);\n            const timeB = b.created_at ? new Date(b.created_at).getTime() : \n                         (b.time ? new Date(`2000-01-01 ${b.time}`).getTime() : 0);\n            return timeA - timeB;\n          });\n          \n          return uniqueMsgs;\n        };\n\n        // Map and de-duplicate by propertyId\n        const mapped = response.inquiries.map(inquiry => ({\n          id: inquiry.id,\n          managerName: (inquiry.property_manager?.first_name || 'Property') + ' ' + (inquiry.property_manager?.last_name || 'Manager'),\n          property: inquiry.property?.title || inquiry.property?.building_name || 'Property',\n          propertyId: inquiry.property_id,\n          unitId: inquiry.unit_id || inquiry.property_id,\n          unitName: inquiry.unit_name || inquiry.property?.title || inquiry.property?.building_name || 'Property',\n          avatar: 'ðŸ¢',\n          status: inquiry.status,\n          messages: toMessages(inquiry),\n          attachments: inquiry.attachments || [],\n          inquiry\n        }));\n        const dedup = [];\n        const seen = new Set();\n        for (const c of mapped) {\n          const key = String(c.propertyId);\n          if (seen.has(key)) continue;\n          seen.add(key);\n          dedup.push(c);\n        }\n        setChats(dedup);\n        \n        // Load attachments for all inquiries\n        for (const chat of dedup) {\n          try {\n            const attData = await api.getInquiryAttachments(chat.id);\n            if (attData && attData.attachments) {\n              setAttachments(prev => ({ ...prev, [chat.id]: attData.attachments }));\n            }\n          } catch (err) {\n            console.error(`Failed to load attachments for inquiry ${chat.id}:`, err);\n          }\n        }\n      }\n    } catch (err) {\n      console.error('Failed to load inquiries:', err);\n      if (err.status === 401) {\n        setError('Please log in to view your inquiries.');\n        // Optionally redirect to login\n        // window.location.href = '/login';\n      } else {\n        setError('Failed to load inquiries. Please try again.');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Load inquiries on mount\n  useEffect(() => {\n    loadInquiries();\n      hydratedRef.current = true;\n  }, []);\n\n  // Persist chats and selection whenever they change\n  useEffect(() => {\n    if (!hydratedRef.current) return; // avoid wiping storage with initial empty state\n    try {\n      if (Array.isArray(chats)) localStorage.setItem('tenant_chats', JSON.stringify(chats));\n      if (selectedChatId) {\n        localStorage.setItem('tenant_selected_chat_id', selectedChatId);\n      }\n    } catch (_) {\n      // storage may be unavailable\n    }\n  }, [chats, selectedChatId]);\n\n  // Create or reuse inquiry when opened from \"INQUIRE NOW\"\n  useEffect(() => {\n    if (!initialChat || !initialChat.propertyId) return;\n\n    const ensureInquiry = async () => {\n      try {\n        setLoading(true);\n        // 1) Load current inquiries to avoid duplicates\n        let existing = chats;\n        if (!Array.isArray(existing) || existing.length === 0) {\n          try {\n            const res = await api.getTenantInquiries();\n            if (res && Array.isArray(res.inquiries)) {\n              // Reuse the same parser as in main load\n              const parser = (inq) => {\n                const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n                const chunks = []; let last = 0; let m;\n                while ((m = regex.exec(String(inq.message || ''))) !== null) {\n                  const txt = String(inq.message || '').slice(last, m.index);\n                  if (txt) chunks.push({ text: txt, ts: null });\n                  chunks.push({ text: null, ts: m[1] ? Number(m[1]) : null });\n                  last = m.index + m[0].length;\n                }\n                const tail = String(inq.message || '').slice(last);\n                if (tail) chunks.push({ text: tail, ts: null });\n                const out = []; let pending = null; const now = Date.now();\n                for (const c of chunks) {\n                  if (c.text === null) { pending = c.ts; continue; }\n                  // Clean the text - remove any separator prefixes\n                  let cleanText = c.text || '';\n                  cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                  cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                  // Skip empty messages after cleaning\n                  if (!cleanText) continue;\n                  \n                  // Filter out placeholder messages\n                  const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n                  if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n                    continue;\n                  }\n                  \n                  out.push({ id: `${inq.id}-t-${out.length}`, sender: 'tenant', text: cleanText, time: new Date(pending || now).toLocaleTimeString() });\n                  pending = null;\n                }\n                if (inq.response_message) {\n                  // Clean manager reply too\n                  let cleanReply = String(inq.response_message || '').replace(/^---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                  cleanReply = cleanReply.replace(/\\s*---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                  if (cleanReply) {\n                    out.push({ id: `${inq.id}-m`, sender: 'manager', text: cleanReply, time: new Date(inq.responded_at || now).toLocaleTimeString() });\n                  }\n                }\n                return out;\n              };\n\n              const mapped = res.inquiries.map(inquiry => ({\n                id: inquiry.id,\n                managerName: (inquiry.property_manager?.first_name || 'Property') + ' ' + (inquiry.property_manager?.last_name || 'Manager'),\n                property: inquiry.property?.title || inquiry.property?.building_name || 'Property',\n                propertyId: inquiry.property_id,\n                unitId: inquiry.unit_id || inquiry.property_id,\n                unitName: inquiry.unit_name || inquiry.property?.title || inquiry.property?.building_name || 'Property',\n                avatar: 'ðŸ¢',\n                status: inquiry.status,\n                messages: parser(inquiry),\n                inquiry\n              }));\n              existing = mapped;\n              setChats(mapped);\n            }\n          } catch (_) { /* ignore load errors here */ }\n        }\n\n        // 2) If an inquiry for this property already exists, just select it and pre-fill message\n        const match = (existing || []).find(c => Number(c.propertyId) === Number(initialChat.propertyId));\n        if (match) {\n          setSelectedChatId(match.id);\n          \n          // Pre-fill message - use a more aggressive approach\n          const preFillMsg = match.messages && match.messages.length > 0\n            ? `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?`\n            : `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n          \n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = (msg) => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', { bubbles: true });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          \n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n          \n          return;\n        }\n\n        // 3) Otherwise, create one - send a minimal placeholder message (required by backend) but don't display it\n        // Instead, pre-fill the text box with the actual message for user to send manually\n        const placeholderMessage = \"Inquiry started\"; // Minimal message required by backend\n        const response = await api.startTenantInquiry(\n          initialChat.propertyId,\n          placeholderMessage,\n          initialChat.unitId || null\n        );\n\n        if (response && response.inquiry) {\n          const newChat = {\n            id: response.inquiry.id,\n            managerName: (response.inquiry.property_manager?.first_name || 'Property') + ' ' + (response.inquiry.property_manager?.last_name || 'Manager'),\n            property: response.inquiry.property?.title || response.inquiry.property?.building_name || 'Property',\n            propertyId: response.inquiry.property_id,\n            unitId: response.inquiry.unit_id || response.inquiry.property_id,\n            unitName: initialChat.unitName || response.inquiry.unit_name || response.inquiry.property?.title || response.inquiry.property?.building_name || 'Property',\n            avatar: 'ðŸ¢',\n            status: response.inquiry.status,\n            // Don't show the placeholder message in chat - start with empty messages array\n            messages: [],\n            inquiry: response.inquiry\n          };\n          \n          // Add to chats and select it\n          setChats(prev => {\n            // Remove any duplicate for this property\n            const filtered = prev.filter(c => Number(c.propertyId) !== Number(newChat.propertyId));\n            return [...filtered, newChat];\n          });\n          setSelectedChatId(newChat.id);\n          \n          // Pre-fill message with the actual message user should send (ready-to-send, not auto-sent)\n          const preFillMsg = `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n          \n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = (msg) => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', { bubbles: true });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          \n          // Clear first, then set the message multiple times\n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n          \n          // Reload inquiries after a delay to ensure everything is in sync\n          setTimeout(async () => {\n            await loadInquiries();\n            // Ensure the chat is still selected and message is set after reload\n            setSelectedChatId(newChat.id);\n            setTimeout(() => forceSetMessage(preFillMsg), 100);\n          }, 300);\n        }\n        else if (response && response.message === 'Inquiry already exists' && response.inquiry) {\n          // Select the existing inquiry\n          const existingChat = {\n            id: response.inquiry.id,\n            managerName: (response.inquiry.property_manager?.first_name || 'Property') + ' ' + (response.inquiry.property_manager?.last_name || 'Manager'),\n            property: response.inquiry.property?.title || response.inquiry.property?.building_name || 'Property',\n            propertyId: response.inquiry.property_id,\n            unitId: response.inquiry.unit_id || response.inquiry.property_id,\n            unitName: initialChat.unitName || response.inquiry.unit_name || response.inquiry.property?.title || response.inquiry.property?.building_name || 'Property',\n            avatar: 'ðŸ¢',\n            status: response.inquiry.status,\n            messages: (function(){\n              const inq = response.inquiry;\n              // Use regex to properly split messages with timestamp support\n              const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n              const parts = [];\n              let lastIndex = 0;\n              let match;\n              let timestamps = [];\n              \n              while ((match = regex.exec(String(inq.message || ''))) !== null) {\n                const textBefore = String(inq.message || '').slice(lastIndex, match.index);\n                if (textBefore.trim()) {\n                  parts.push({ text: textBefore, ts: timestamps[parts.length] || null });\n                }\n                timestamps.push(match[1] ? Number(match[1]) : null);\n                lastIndex = match.index + match[0].length;\n              }\n              \n              const tail = String(inq.message || '').slice(lastIndex);\n              if (tail.trim()) {\n                parts.push({ text: tail, ts: timestamps[parts.length] || null });\n              }\n              \n              const nowMs = Date.now();\n              const startMs = nowMs - (Math.max(0, parts.length - 1) * 60000);\n              \n              return parts.map((p, idx) => {\n                // Clean the text - remove any separator prefixes\n                let cleanText = p.text || '';\n                cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                // Skip empty messages\n                if (!cleanText) return null;\n                \n                // Filter out placeholder messages\n                const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n                if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n                  return null;\n                }\n                \n                return {\n                  id: `${inq.id}-t-${idx}`,\n                  sender: 'tenant',\n                  text: cleanText,\n                  time: new Date(p.ts || startMs + idx * 60000).toLocaleTimeString()\n                };\n              }).filter(Boolean); // Remove null entries\n            })(),\n            inquiry: response.inquiry\n          };\n          setChats(prev => {\n            // Remove any duplicate for this property\n            const filtered = prev.filter(c => Number(c.propertyId) !== Number(existingChat.propertyId));\n            return [...filtered, existingChat];\n          });\n          setSelectedChatId(existingChat.id);\n          \n          // Pre-fill message - use a more aggressive approach\n          const preFillMsg = existingChat.messages && existingChat.messages.length > 0\n            ? `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?`\n            : `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n          \n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = (msg) => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', { bubbles: true });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          \n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n        }\n      } catch (err) {\n        console.error('Failed to create inquiry:', err);\n        if (err.status === 401) {\n          setError('Please log in to create an inquiry.');\n        } else if (err.status === 500) {\n          setError('Server error. Please try again later.');\n        } else {\n          setError('Failed to create inquiry. Please try again.');\n        }\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    ensureInquiry();\n  }, [initialChat]);\n\n  const selectedChat = useMemo(() => chats.find(c => c.id === selectedChatId) || null, [chats, selectedChatId]);\n\n  // Pre-fill message when a chat matching initialChat is selected (multiple attempts for reliability)\n  useEffect(() => {\n    if (!initialChat || !selectedChatId) return;\n    \n    // Check if selected chat matches initialChat property\n    const matchedChat = chats.find(c => c.id === selectedChatId && Number(c.propertyId) === Number(initialChat.propertyId));\n    if (!matchedChat) return;\n    \n    // Only pre-fill once per chat\n    if (preFilledMessageRef.current.has(selectedChatId)) return;\n    \n    // Set message with multiple attempts to ensure it gets set\n    const attemptSetMessage = () => {\n      setMessage(current => {\n        // Only set if message is currently empty\n        if (current.trim()) return current;\n        \n        // Determine message based on chat state\n        if (matchedChat.messages && matchedChat.messages.length > 0) {\n          preFilledMessageRef.current.add(selectedChatId);\n          return `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?`;\n        } else {\n          preFilledMessageRef.current.add(selectedChatId);\n          return `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n        }\n      });\n    };\n    \n    // Try immediately\n    attemptSetMessage();\n    \n    // Try again after a short delay as fallback\n    const timeout1 = setTimeout(attemptSetMessage, 100);\n    const timeout2 = setTimeout(attemptSetMessage, 300);\n    \n    return () => {\n      clearTimeout(timeout1);\n      clearTimeout(timeout2);\n    };\n  }, [selectedChatId, chats, initialChat]);\n\n  const handleSendMessage = async () => {\n    if (!message.trim() || !selectedChat) return;\n    \n    try {\n      setLoading(true);\n      const response = await api.sendTenantMessage(selectedChat.id, message.trim());\n      \n      if (response && response.success) {\n        const messageText = message.trim();\n        const now = new Date();\n        // Optimistically add the message to the chat with correct time\n        setChats(prev => prev.map(c => c.id === selectedChat.id ? {\n          ...c,\n          messages: [...c.messages, { \n            id: `temp-${Date.now()}`, \n            sender: 'tenant', \n            text: messageText, \n            time: formatMessageTime(now),\n            created_at: now.toISOString()\n          }]\n        } : c));\n        setMessage('');\n        \n        // Reload to get updated data from backend\n        await loadInquiries();\n        \n        // Re-select the same chat after reload\n        setSelectedChatId(selectedChat.id);\n      } else {\n        setError('Failed to send message. Please try again.');\n      }\n    } catch (err) {\n      console.error('Failed to send message:', err);\n      setError('Failed to send message. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleFileSelect = (e) => {\n    const files = Array.from(e.target.files);\n    setSelectedFiles(files);\n  };\n\n  const handleFileUpload = async () => {\n    if (!selectedFiles.length || !selectedChat) return;\n    \n    try {\n      setUploadingFiles(true);\n      const response = await api.uploadInquiryAttachments(selectedChat.id, selectedFiles);\n      \n      if (response && response.attachments) {\n        console.log('Uploaded attachments:', response.attachments);\n        // Update attachments for this inquiry immediately\n        setAttachments(prev => {\n          const updated = {\n            ...prev,\n            [selectedChat.id]: [...(prev[selectedChat.id] || []), ...response.attachments]\n          };\n          console.log('Updated attachments state:', updated);\n          return updated;\n        });\n        setSelectedFiles([]);\n        if (fileInputRef.current) fileInputRef.current.value = '';\n        \n        // Reload to get updated data and ensure everything is in sync\n        await loadInquiries();\n        \n        // Re-select the same chat after reload\n        setSelectedChatId(selectedChat.id);\n      } else {\n        setError('Failed to upload files. Please try again.');\n      }\n    } catch (err) {\n      console.error('Failed to upload files:', err);\n      setError('Failed to upload files. Please try again.');\n    } finally {\n      setUploadingFiles(false);\n    }\n  };\n\n  const handleDownloadAttachment = async (attachmentId, fileName) => {\n    try {\n      const blob = await api.downloadInquiryAttachment(attachmentId);\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = fileName;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n    } catch (err) {\n      console.error('Failed to download attachment:', err);\n      setError('Failed to download file. Please try again.');\n    }\n  };\n\n  const handleDeleteAttachment = async (attachmentId, inquiryId) => {\n    if (!window.confirm('Are you sure you want to delete this file?')) return;\n    \n    try {\n      await api.deleteInquiryAttachment(attachmentId);\n      setAttachments(prev => ({\n        ...prev,\n        [inquiryId]: (prev[inquiryId] || []).filter(att => att.id !== attachmentId)\n      }));\n      \n      // Reload to get updated data\n      await loadInquiries();\n    } catch (err) {\n      console.error('Failed to delete attachment:', err);\n      setError('Failed to delete file. Please try again.');\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') handleSendMessage();\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-3 z-50\">\n      <div className=\"bg-white rounded-xl w-full max-w-6xl max-h-[90vh] shadow-2xl overflow-hidden\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white\">\n          <div className=\"flex items-center space-x-3\">\n            <button\n              onClick={onClose}\n              className=\"w-9 h-9 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-all duration-300 shadow-lg\"\n            >\n              <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n              </svg>\n            </button>\n            <div>\n              <h1 className=\"text-lg font-black text-black\">My Property Inquiries</h1>\n              <p className=\"text-xs text-gray-500\">Chat with property managers about available properties</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Error Message */}\n        {error && (\n          <div className=\"bg-red-50 border-l-4 border-red-400 p-4 mx-4 mt-2\">\n            <div className=\"flex\">\n              <div className=\"ml-3\">\n                <p className=\"text-sm text-red-700\">{error}</p>\n                <button \n                  onClick={() => setError(null)}\n                  className=\"text-xs text-red-600 underline mt-1\"\n                >\n                  Dismiss\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Main Content */}\n        <div className=\"flex h-[calc(90vh-72px)]\">\n          {/* Left Panel - Chat List */}\n          <div className=\"w-80 border-r border-gray-200 bg-gray-50\">\n            {/* Tabs */}\n            <div className=\"flex border-b border-gray-200\">\n              <button\n                onClick={() => {}}\n                className={`flex-1 py-3 px-4 text-sm font-medium transition-colors ${\n                  'bg-white text-black border-b-2 border-black'\n                }`}\n              >\n                Active Chats\n              </button>\n              <button\n                onClick={() => {}}\n                className={`flex-1 py-3 px-4 text-sm font-medium transition-colors ${\n                  'text-gray-600 hover:text-black hover:bg-gray-100'\n                }`}\n              >\n                New Properties\n              </button>\n            </div>\n\n            {/* Search */}\n            <div className=\"p-4\">\n              <div className=\"relative\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <svg className=\"h-4 w-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n                  </svg>\n                </div>\n                <input\n                  type=\"text\"\n                  placeholder=\"Search chats...\"\n                  className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-sm\"\n                />\n              </div>\n            </div>\n\n            {/* Chat/Property List */}\n            <div className=\"flex-1 overflow-y-auto\">\n              {/* Loading State */}\n              {loading && chats.length === 0 ? (\n                <div className=\"p-4 text-center\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-black mx-auto\"></div>\n                  <p className=\"text-sm text-gray-500 mt-2\">Loading inquiries...</p>\n                </div>\n              ) : (\n                /* Active Chats */\n              <div className=\"space-y-1 px-2\">\n                {chats.length === 0 ? (\n                  <div className=\"p-4 text-sm text-gray-500\">No conversations yet. Start an inquiry from a unit to chat with a manager.</div>\n                ) : (\n                  chats.map((chat) => (\n                    <div\n                      key={chat.id}\n                      onClick={() => setSelectedChatId(chat.id)}\n                      className={`p-3 rounded-lg cursor-pointer transition-colors ${\n                        selectedChatId === chat.id ? 'bg-gray-200' : 'hover:bg-gray-100'\n                      }`}\n                    >\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"relative\">\n                          <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                            <span className=\"text-sm font-medium text-blue-600\">{chat.avatar}</span>\n                          </div>\n                          {chat.status === 'online' && (\n                            <div className=\"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"></div>\n                          )}\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between\">\n                            <p className=\"text-sm font-medium text-gray-900 truncate\">{chat.managerName}</p>\n                            <span className=\"text-xs text-gray-500\">{chat.messages[chat.messages.length - 1]?.time}</span>\n                          </div>\n                          <p className=\"text-xs text-gray-600 truncate\">{chat.property}</p>\n                          <p className=\"text-xs text-gray-500 truncate\">{\n                            String(chat.messages[chat.messages.length - 1]?.text || '')\n                              .replace(/---\\s*Manager Reply\\s*\\[\\d{10,}\\]\\s*---/g, '')\n                              .replace(/---\\s*New Message\\s*(?:\\[\\d{10,}\\])?\\s*---/g, '')\n                          }</p>\n                        </div>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n              )}\n            </div>\n          </div>\n\n          {/* Right Panel - Chat Conversation */}\n          <div className=\"flex-1 flex flex-col bg-white\">\n            {/* Chat Header */}\n            <div className=\"flex items-center justify-between p-4 border-b border-gray-200\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"relative\">\n                  <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                    <span className=\"text-sm font-medium text-blue-600\">\n                      {selectedChat?.avatar || 'PM'}\n                    </span>\n                  </div>\n                    {selectedChat?.status === 'online' && (\n                    <div className=\"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"></div>\n                  )}\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-900\">\n                    {selectedChat?.managerName || 'Property Manager'}\n                  </h3>\n                  <p className=\"text-xs text-gray-500\">\n                    {selectedChat?.unitName || selectedChat?.property || 'Property'}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Messages */}\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n              {/* Combine messages and unmatched attachments, then sort by timestamp */}\n              {(() => {\n                const unmatchedAttachments = getUnmatchedAttachments(selectedChat?.id, selectedChat?.messages || []);\n                console.log('Unmatched attachments for inquiry', selectedChat?.id, ':', unmatchedAttachments);\n                console.log('All attachments for inquiry', selectedChat?.id, ':', attachments[selectedChat?.id]);\n                const allItems = [];\n                \n                // Add all messages\n                (selectedChat?.messages || []).forEach(msg => {\n                  allItems.push({ type: 'message', data: msg, timestamp: msg.created_at ? new Date(msg.created_at).getTime() : 0 });\n                });\n                \n                // Add unmatched attachments as virtual messages\n                unmatchedAttachments.forEach(att => {\n                  allItems.push({ \n                    type: 'attachment', \n                    data: att, \n                    timestamp: att.created_at ? new Date(att.created_at).getTime() : 0 \n                  });\n                });\n                \n                // Sort by timestamp\n                allItems.sort((a, b) => a.timestamp - b.timestamp);\n                \n                return allItems.map((item, idx) => {\n                  if (item.type === 'attachment') {\n                    const att = item.data;\n                    // Determine sender based on uploaded_by\n                    const currentChat = chats.find(c => c.id === selectedChat?.id);\n                    const isTenant = currentChat?.inquiry?.tenant_id && \n                                    att.uploaded_by && \n                                    String(att.uploaded_by) === String(currentChat.inquiry.tenant_id);\n                    const sender = isTenant ? 'tenant' : 'manager';\n                    \n                    return (\n                      <div\n                        key={`att-${att.id}`}\n                        className={`flex ${sender === 'tenant' ? 'justify-end' : 'justify-start'}`}\n                      >\n                        <div\n                          className={`max-w-xs lg:max-w-md rounded-lg overflow-hidden ${\n                            sender === 'tenant'\n                              ? 'bg-black text-white'\n                              : 'bg-gray-200 text-gray-900'\n                          }`}\n                        >\n                          {/* Images and Videos */}\n                          {(isImage(att.mime_type, att.file_type) || isVideo(att.mime_type, att.file_type)) && (\n                            <div className=\"relative\">\n                                      {isImage(att.mime_type, att.file_type) ? (\n                                        <MediaDisplay\n                                          attachment={att}\n                                          type=\"image\"\n                                          getMediaUrl={getMediaUrl}\n                                          getAttachmentUrl={getAttachmentUrl}\n                                          onImageClick={setLightboxImage}\n                                        />\n                                      ) : (\n                                        <MediaDisplay\n                                          attachment={att}\n                                          type=\"video\"\n                                          getMediaUrl={getMediaUrl}\n                                          getAttachmentUrl={getAttachmentUrl}\n                                          onImageClick={setLightboxImage}\n                                        />\n                                      )}\n                            </div>\n                          )}\n                          \n                          {/* File Attachments */}\n                          {!isImage(att.mime_type, att.file_type) && !isVideo(att.mime_type, att.file_type) && (\n                            <div className=\"px-4 pt-2 pb-2\">\n                              <div\n                                className={`flex items-center space-x-2 p-2 rounded ${\n                                  sender === 'tenant'\n                                    ? 'bg-gray-800'\n                                    : 'bg-gray-300'\n                                }`}\n                              >\n                                <svg className=\"w-5 h-5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                                </svg>\n                                <div className=\"flex-1 min-w-0\">\n                                  <p className=\"text-xs font-medium truncate\">{att.file_name}</p>\n                                  <p className=\"text-xs opacity-75\">\n                                    {(att.file_size / 1024).toFixed(1)} KB\n                                  </p>\n                                </div>\n                                <button\n                                  onClick={() => handleDownloadAttachment(att.id, att.file_name)}\n                                  className=\"p-1 hover:opacity-75 transition-opacity\"\n                                  title=\"Download\"\n                                >\n                                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" />\n                                  </svg>\n                                </button>\n                              </div>\n                            </div>\n                          )}\n                          \n                          {/* Timestamp */}\n                          <div className=\"px-4 pb-2\">\n                            <p className={`text-xs ${sender === 'tenant' ? 'text-gray-300' : 'text-gray-500'}`}>\n                              {formatMessageTime(att.created_at)}\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  } else {\n                    // Regular message\n                    const msg = item.data;\n                    const messageAttachments = getMessageAttachments(msg, selectedChat.id);\n                    const hasAttachments = messageAttachments.length > 0;\n                    const hasText = msg.text && msg.text.trim().length > 0;\n                    \n                    return (\n                      <div\n                        key={msg.id}\n                        className={`flex ${msg.sender === 'tenant' ? 'justify-end' : 'justify-start'}`}\n                      >\n                        <div\n                          className={`max-w-xs lg:max-w-md rounded-lg overflow-hidden ${\n                            msg.sender === 'tenant'\n                              ? 'bg-black text-white'\n                              : 'bg-gray-200 text-gray-900'\n                          }`}\n                        >\n                          {/* Images and Videos */}\n                          {hasAttachments && messageAttachments.filter(att => isImage(att.mime_type, att.file_type) || isVideo(att.mime_type, att.file_type)).length > 0 && (\n                            <div className=\"space-y-1\">\n                              {messageAttachments\n                                .filter(att => isImage(att.mime_type, att.file_type) || isVideo(att.mime_type, att.file_type))\n                                .map((att) => (\n                                  <div key={att.id} className=\"relative\">\n                              {isImage(att.mime_type, att.file_type) ? (\n                                <MediaDisplay\n                                  attachment={att}\n                                  type=\"image\"\n                                  getMediaUrl={getMediaUrl}\n                                  getAttachmentUrl={getAttachmentUrl}\n                                  onImageClick={setLightboxImage}\n                                />\n                              ) : (\n                                <MediaDisplay\n                                  attachment={att}\n                                  type=\"video\"\n                                  getMediaUrl={getMediaUrl}\n                                  getAttachmentUrl={getAttachmentUrl}\n                                  onImageClick={setLightboxImage}\n                                />\n                              )}\n                                  </div>\n                                ))}\n                            </div>\n                          )}\n                          \n                          {/* Text Message */}\n                          {hasText && (\n                            <div className=\"px-4 py-2\">\n                              <p className=\"text-sm whitespace-pre-wrap break-words\">{msg.text}</p>\n                            </div>\n                          )}\n                          \n                          {/* File Attachments */}\n                          {hasAttachments && messageAttachments.filter(att => !isImage(att.mime_type, att.file_type) && !isVideo(att.mime_type, att.file_type)).length > 0 && (\n                            <div className={`px-4 ${hasText ? 'pt-2' : 'pt-2'} pb-2 space-y-2`}>\n                              {messageAttachments\n                                .filter(att => !isImage(att.mime_type, att.file_type) && !isVideo(att.mime_type, att.file_type))\n                                .map((att) => (\n                                  <div\n                                    key={att.id}\n                                    className={`flex items-center space-x-2 p-2 rounded ${\n                                      msg.sender === 'tenant'\n                                        ? 'bg-gray-800'\n                                        : 'bg-gray-300'\n                                    }`}\n                                  >\n                                    <svg className=\"w-5 h-5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                                    </svg>\n                                    <div className=\"flex-1 min-w-0\">\n                                      <p className=\"text-xs font-medium truncate\">{att.file_name}</p>\n                                      <p className=\"text-xs opacity-75\">\n                                        {(att.file_size / 1024).toFixed(1)} KB\n                                      </p>\n                                    </div>\n                                    <button\n                                      onClick={() => handleDownloadAttachment(att.id, att.file_name)}\n                                      className=\"p-1 hover:opacity-75 transition-opacity\"\n                                      title=\"Download\"\n                                    >\n                                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" />\n                                      </svg>\n                                    </button>\n                                  </div>\n                                ))}\n                            </div>\n                          )}\n                          \n                          {/* Timestamp */}\n                          <div className={`px-4 pb-2 ${hasAttachments && !hasText ? 'pt-2' : ''}`}>\n                            <p className={`text-xs ${\n                              msg.sender === 'tenant' ? 'text-gray-300' : 'text-gray-500'\n                            }`}>\n                              {msg.time}\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  }\n                });\n              })()}\n              \n              {(!selectedChat?.messages || selectedChat.messages.length === 0) && \n               (!attachments[selectedChat?.id] || attachments[selectedChat.id].length === 0) && (\n                <div className=\"text-center text-gray-500 py-8\">\n                  <p>No messages yet. Start the conversation!</p>\n                </div>\n              )}\n            </div>\n\n\n            {/* Message Input */}\n            <div className=\"p-4 border-t border-gray-200\">\n              {/* File Selection Preview */}\n              {selectedFiles.length > 0 && (\n                <div className=\"mb-2 flex flex-wrap gap-2\">\n                  {selectedFiles.map((file, idx) => (\n                    <div key={idx} className=\"flex items-center space-x-2 bg-gray-100 px-3 py-1 rounded-lg text-sm\">\n                      <span className=\"text-gray-700\">{file.name}</span>\n                      <button\n                        onClick={() => setSelectedFiles(prev => prev.filter((_, i) => i !== idx))}\n                        className=\"text-red-600 hover:text-red-800\"\n                      >\n                        Ã—\n                      </button>\n                    </div>\n                  ))}\n                  <button\n                    onClick={handleFileUpload}\n                    disabled={uploadingFiles}\n                    className=\"bg-blue-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50\"\n                  >\n                    {uploadingFiles ? 'Uploading...' : 'Upload'}\n                  </button>\n                </div>\n              )}\n              \n              <div className=\"flex items-center space-x-3\">\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  multiple\n                  accept=\"image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx\"\n                  onChange={handleFileSelect}\n                  className=\"hidden\"\n                  id=\"file-input\"\n                />\n                <label\n                  htmlFor=\"file-input\"\n                  className=\"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors cursor-pointer\"\n                >\n                  <svg className=\"w-5 h-5 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\n                  </svg>\n                </label>\n                <input\n                  ref={messageInputRef}\n                  type=\"text\"\n                  value={message || ''}\n                  onChange={(e) => setMessage(e.target.value)}\n                  onKeyPress={handleKeyPress}\n                  placeholder=\"Type your message to the property manager...\"\n                  className=\"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-black placeholder-gray-400\"\n                />\n                <button\n                  onClick={handleSendMessage}\n                  disabled={loading || !message.trim()}\n                  className=\"w-10 h-10 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {loading ? (\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                  ) : (\n                  <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\n                  </svg>\n                  )}\n                </button>\n              </div>\n              <p className=\"text-xs text-gray-500 mt-2 text-center\">\n                You're chatting with the property manager about {selectedChat?.unitName || selectedChat?.property || 'this unit'}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Image Lightbox Modal */}\n      {lightboxImage && (\n        <div \n          className=\"fixed inset-0 z-[200] bg-black bg-opacity-90 flex items-center justify-center p-4\"\n          onClick={() => setLightboxImage(null)}\n        >\n          <div className=\"relative max-w-7xl max-h-full w-full h-full flex items-center justify-center\">\n            <button\n              onClick={() => setLightboxImage(null)}\n              className=\"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors z-10\"\n            >\n              <svg className=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n            <img\n              src={lightboxImage.url}\n              alt={lightboxImage.fileName}\n              className=\"max-w-full max-h-full object-contain\"\n              onClick={(e) => e.stopPropagation()}\n            />\n            {lightboxImage.fileName && (\n              <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-75 text-white px-4 py-2 rounded-lg text-sm\">\n                {lightboxImage.fileName}\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Inquiries;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}