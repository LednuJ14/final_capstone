{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Lenovo\\\\OneDrive\\\\Desktop\\\\Capstone-Project-jun\\\\main-domain\\\\frontend\\\\src\\\\components\\\\Tenants\\\\Inquiries.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport api from '../../services/api';\n\n// Props:\n// - onClose(): close modal\n// - initialChat: { id?, managerName, property, unitId, propertyId }\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Inquiries = ({\n  onClose,\n  initialChat = null\n}) => {\n  _s();\n  var _selectedChat$message;\n  const [message, setMessage] = useState('');\n  const [chats, setChats] = useState([]); // [{id, managerName, property, avatar, status, messages: [{id, sender, text, time}]}]\n  const [selectedChatId, setSelectedChatId] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [uploadingFiles, setUploadingFiles] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState([]);\n  const [attachments, setAttachments] = useState({}); // {inquiryId: [attachments]}\n  const hydratedRef = useRef(false);\n  const preFilledMessageRef = useRef(new Set()); // Track which chats have had messages pre-filled\n  const messageInputRef = useRef(null); // Reference to the message input element\n  const fileInputRef = useRef(null);\n\n  // Load inquiries from backend API\n  const loadInquiries = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Check if user is authenticated\n      const accessToken = localStorage.getItem('access_token') || localStorage.getItem('token');\n      if (!accessToken) {\n        setError('Please log in to view your inquiries.');\n        setLoading(false);\n        return;\n      }\n      const response = await api.getTenantInquiries();\n      if (response && response.inquiries) {\n        // Helper: explode concatenated text (tenant + manager) into chronological bubbles with embedded timestamps\n        const toMessages = inq => {\n          const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n          const chunks = [];\n          let lastIndex = 0;\n          let match;\n          while ((match = regex.exec(String(inq.message || ''))) !== null) {\n            const ts = match[1] ? Number(match[1]) : null;\n            const text = String(inq.message || '').slice(lastIndex, match.index);\n            if (text) chunks.push({\n              text,\n              ts: null\n            });\n            lastIndex = match.index + match[0].length;\n            // next text will carry ts via subsequent slice\n            chunks.push({\n              text: null,\n              ts\n            });\n          }\n          const tail = String(inq.message || '').slice(lastIndex);\n          if (tail) chunks.push({\n            text: tail,\n            ts: null\n          });\n\n          // Merge markers (ts) with following text blocks\n          const parts = [];\n          let pendingTs = null;\n          for (const c of chunks) {\n            if (c.text === null && c.ts) {\n              pendingTs = c.ts;\n            } else if (c.text) {\n              parts.push({\n                text: c.text,\n                ts: pendingTs\n              });\n              pendingTs = null;\n            }\n          }\n          const msgs = parts.map((p, idx) => {\n            // Clean the text - remove any separator prefixes that might still be present\n            let cleanText = p.text || '';\n            // Remove any remaining \"--- New Message [timestamp] ---\" prefixes\n            cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n            // Remove any at the end too\n            cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n            // Skip empty messages after cleaning\n            if (!cleanText) return null;\n\n            // Filter out placeholder messages (don't show them in chat)\n            const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n            if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n              return null;\n            }\n            return {\n              id: `${inq.id}-t-${idx}`,\n              sender: 'tenant',\n              text: cleanText,\n              time: new Date(p.ts || Date.now()).toLocaleTimeString([], {\n                hour: 'numeric',\n                minute: '2-digit'\n              })\n            };\n          }).filter(Boolean); // Remove null entries\n\n          // Also explode manager replies stored in response_message using timestamped delimiters\n          // Note: This is for backward compatibility. New system uses inquiry_messages table\n          if (inq.response_message) {\n            const mSep = /\\n\\n--- Manager Reply \\[(\\d{10,})\\] ---\\n/g;\n            const mSrc = String(inq.response_message || '');\n            const mParts = [];\n            let mLast = 0;\n            let mm;\n            while ((mm = mSep.exec(mSrc)) !== null) {\n              const txt = mSrc.slice(mLast, mm.index);\n              if (txt) mParts.push({\n                text: txt,\n                ts: null\n              });\n              mParts.push({\n                text: null,\n                ts: mm[1] ? Number(mm[1]) : null\n              });\n              mLast = mm.index + mm[0].length;\n            }\n            const mTail = mSrc.slice(mLast);\n            if (mTail) mParts.push({\n              text: mTail,\n              ts: null\n            });\n            let mPending = null;\n            const now = Date.now();\n            for (const part of mParts) {\n              if (part.text === null) {\n                mPending = part.ts;\n                continue;\n              }\n              // Clean manager reply text - remove any separator prefixes\n              let cleanText = part.text || '';\n              cleanText = cleanText.replace(/^---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n              cleanText = cleanText.replace(/\\s*---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n              // Skip empty messages after cleaning\n              if (!cleanText) continue;\n              msgs.push({\n                id: `${inq.id}-m-${msgs.length}`,\n                sender: 'manager',\n                text: cleanText,\n                time: new Date(mPending || now).toLocaleTimeString([], {\n                  hour: 'numeric',\n                  minute: '2-digit'\n                })\n              });\n              mPending = null;\n            }\n          }\n\n          // Also check for messages from inquiry_messages table if available (new format)\n          if (inq.messages && Array.isArray(inq.messages) && inq.messages.length > 0) {\n            // Use messages from inquiry_messages table as primary source\n            // These are already properly formatted by the backend\n            const newFormatMsgs = inq.messages.map(msg => ({\n              id: `msg-${msg.id}`,\n              sender: msg.sender || (msg.sender_id === inq.tenant_id ? 'tenant' : 'manager'),\n              text: msg.message || msg.text || '',\n              time: msg.created_at ? new Date(msg.created_at).toLocaleTimeString([], {\n                hour: 'numeric',\n                minute: '2-digit'\n              }) : new Date().toLocaleTimeString([], {\n                hour: 'numeric',\n                minute: '2-digit'\n              })\n            }));\n\n            // If we have new format messages, use them instead of parsed old format\n            // Merge with any old format messages that might not be in the new table yet\n            const allMsgs = [...msgs, ...newFormatMsgs];\n\n            // Remove duplicates based on text content and sort by time\n            const uniqueMsgs = [];\n            const seenTexts = new Set();\n            for (const msg of allMsgs) {\n              const textKey = `${msg.sender}-${msg.text}`;\n              if (!seenTexts.has(textKey)) {\n                seenTexts.add(textKey);\n                uniqueMsgs.push(msg);\n              }\n            }\n\n            // Sort by created_at if available, otherwise by time string\n            uniqueMsgs.sort((a, b) => {\n              // Try to get timestamp from message object if available\n              const timeA = a.created_at ? new Date(a.created_at).getTime() : a.time ? new Date(`2000-01-01 ${a.time}`).getTime() : 0;\n              const timeB = b.created_at ? new Date(b.created_at).getTime() : b.time ? new Date(`2000-01-01 ${b.time}`).getTime() : 0;\n              return timeA - timeB;\n            });\n            return uniqueMsgs;\n          }\n          return msgs;\n        };\n\n        // Map and de-duplicate by propertyId\n        const mapped = response.inquiries.map(inquiry => {\n          var _inquiry$property_man, _inquiry$property_man2, _inquiry$property, _inquiry$property2, _inquiry$property3, _inquiry$property4;\n          return {\n            id: inquiry.id,\n            managerName: (((_inquiry$property_man = inquiry.property_manager) === null || _inquiry$property_man === void 0 ? void 0 : _inquiry$property_man.first_name) || 'Property') + ' ' + (((_inquiry$property_man2 = inquiry.property_manager) === null || _inquiry$property_man2 === void 0 ? void 0 : _inquiry$property_man2.last_name) || 'Manager'),\n            property: ((_inquiry$property = inquiry.property) === null || _inquiry$property === void 0 ? void 0 : _inquiry$property.title) || ((_inquiry$property2 = inquiry.property) === null || _inquiry$property2 === void 0 ? void 0 : _inquiry$property2.building_name) || 'Property',\n            propertyId: inquiry.property_id,\n            unitId: inquiry.unit_id || inquiry.property_id,\n            unitName: inquiry.unit_name || ((_inquiry$property3 = inquiry.property) === null || _inquiry$property3 === void 0 ? void 0 : _inquiry$property3.title) || ((_inquiry$property4 = inquiry.property) === null || _inquiry$property4 === void 0 ? void 0 : _inquiry$property4.building_name) || 'Property',\n            avatar: 'ðŸ¢',\n            status: inquiry.status,\n            messages: toMessages(inquiry),\n            attachments: inquiry.attachments || [],\n            inquiry\n          };\n        });\n        const dedup = [];\n        const seen = new Set();\n        for (const c of mapped) {\n          const key = String(c.propertyId);\n          if (seen.has(key)) continue;\n          seen.add(key);\n          dedup.push(c);\n        }\n        setChats(dedup);\n\n        // Load attachments for all inquiries\n        for (const chat of dedup) {\n          try {\n            const attData = await api.getInquiryAttachments(chat.id);\n            if (attData && attData.attachments) {\n              setAttachments(prev => ({\n                ...prev,\n                [chat.id]: attData.attachments\n              }));\n            }\n          } catch (err) {\n            console.error(`Failed to load attachments for inquiry ${chat.id}:`, err);\n          }\n        }\n      }\n    } catch (err) {\n      console.error('Failed to load inquiries:', err);\n      if (err.status === 401) {\n        setError('Please log in to view your inquiries.');\n        // Optionally redirect to login\n        // window.location.href = '/login';\n      } else {\n        setError('Failed to load inquiries. Please try again.');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Load inquiries on mount\n  useEffect(() => {\n    loadInquiries();\n    hydratedRef.current = true;\n  }, []);\n\n  // Persist chats and selection whenever they change\n  useEffect(() => {\n    if (!hydratedRef.current) return; // avoid wiping storage with initial empty state\n    try {\n      if (Array.isArray(chats)) localStorage.setItem('tenant_chats', JSON.stringify(chats));\n      if (selectedChatId) {\n        localStorage.setItem('tenant_selected_chat_id', selectedChatId);\n      }\n    } catch (_) {\n      // storage may be unavailable\n    }\n  }, [chats, selectedChatId]);\n\n  // Create or reuse inquiry when opened from \"INQUIRE NOW\"\n  useEffect(() => {\n    if (!initialChat || !initialChat.propertyId) return;\n    const ensureInquiry = async () => {\n      try {\n        setLoading(true);\n        // 1) Load current inquiries to avoid duplicates\n        let existing = chats;\n        if (!Array.isArray(existing) || existing.length === 0) {\n          try {\n            const res = await api.getTenantInquiries();\n            if (res && Array.isArray(res.inquiries)) {\n              // Reuse the same parser as in main load\n              const parser = inq => {\n                const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n                const chunks = [];\n                let last = 0;\n                let m;\n                while ((m = regex.exec(String(inq.message || ''))) !== null) {\n                  const txt = String(inq.message || '').slice(last, m.index);\n                  if (txt) chunks.push({\n                    text: txt,\n                    ts: null\n                  });\n                  chunks.push({\n                    text: null,\n                    ts: m[1] ? Number(m[1]) : null\n                  });\n                  last = m.index + m[0].length;\n                }\n                const tail = String(inq.message || '').slice(last);\n                if (tail) chunks.push({\n                  text: tail,\n                  ts: null\n                });\n                const out = [];\n                let pending = null;\n                const now = Date.now();\n                for (const c of chunks) {\n                  if (c.text === null) {\n                    pending = c.ts;\n                    continue;\n                  }\n                  // Clean the text - remove any separator prefixes\n                  let cleanText = c.text || '';\n                  cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                  cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                  // Skip empty messages after cleaning\n                  if (!cleanText) continue;\n\n                  // Filter out placeholder messages\n                  const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n                  if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n                    continue;\n                  }\n                  out.push({\n                    id: `${inq.id}-t-${out.length}`,\n                    sender: 'tenant',\n                    text: cleanText,\n                    time: new Date(pending || now).toLocaleTimeString()\n                  });\n                  pending = null;\n                }\n                if (inq.response_message) {\n                  // Clean manager reply too\n                  let cleanReply = String(inq.response_message || '').replace(/^---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                  cleanReply = cleanReply.replace(/\\s*---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                  if (cleanReply) {\n                    out.push({\n                      id: `${inq.id}-m`,\n                      sender: 'manager',\n                      text: cleanReply,\n                      time: new Date(inq.responded_at || now).toLocaleTimeString()\n                    });\n                  }\n                }\n                return out;\n              };\n              const mapped = res.inquiries.map(inquiry => {\n                var _inquiry$property_man3, _inquiry$property_man4, _inquiry$property5, _inquiry$property6, _inquiry$property7, _inquiry$property8;\n                return {\n                  id: inquiry.id,\n                  managerName: (((_inquiry$property_man3 = inquiry.property_manager) === null || _inquiry$property_man3 === void 0 ? void 0 : _inquiry$property_man3.first_name) || 'Property') + ' ' + (((_inquiry$property_man4 = inquiry.property_manager) === null || _inquiry$property_man4 === void 0 ? void 0 : _inquiry$property_man4.last_name) || 'Manager'),\n                  property: ((_inquiry$property5 = inquiry.property) === null || _inquiry$property5 === void 0 ? void 0 : _inquiry$property5.title) || ((_inquiry$property6 = inquiry.property) === null || _inquiry$property6 === void 0 ? void 0 : _inquiry$property6.building_name) || 'Property',\n                  propertyId: inquiry.property_id,\n                  unitId: inquiry.unit_id || inquiry.property_id,\n                  unitName: inquiry.unit_name || ((_inquiry$property7 = inquiry.property) === null || _inquiry$property7 === void 0 ? void 0 : _inquiry$property7.title) || ((_inquiry$property8 = inquiry.property) === null || _inquiry$property8 === void 0 ? void 0 : _inquiry$property8.building_name) || 'Property',\n                  avatar: 'ðŸ¢',\n                  status: inquiry.status,\n                  messages: parser(inquiry),\n                  inquiry\n                };\n              });\n              existing = mapped;\n              setChats(mapped);\n            }\n          } catch (_) {/* ignore load errors here */}\n        }\n\n        // 2) If an inquiry for this property already exists, just select it and pre-fill message\n        const match = (existing || []).find(c => Number(c.propertyId) === Number(initialChat.propertyId));\n        if (match) {\n          setSelectedChatId(match.id);\n\n          // Pre-fill message - use a more aggressive approach\n          const preFillMsg = match.messages && match.messages.length > 0 ? `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?` : `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n\n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = msg => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', {\n                bubbles: true\n              });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n          return;\n        }\n\n        // 3) Otherwise, create one - send a minimal placeholder message (required by backend) but don't display it\n        // Instead, pre-fill the text box with the actual message for user to send manually\n        const placeholderMessage = \"Inquiry started\"; // Minimal message required by backend\n        const response = await api.startTenantInquiry(initialChat.propertyId, placeholderMessage, initialChat.unitId || null);\n        if (response && response.inquiry) {\n          var _response$inquiry$pro, _response$inquiry$pro2, _response$inquiry$pro3, _response$inquiry$pro4, _response$inquiry$pro5, _response$inquiry$pro6;\n          const newChat = {\n            id: response.inquiry.id,\n            managerName: (((_response$inquiry$pro = response.inquiry.property_manager) === null || _response$inquiry$pro === void 0 ? void 0 : _response$inquiry$pro.first_name) || 'Property') + ' ' + (((_response$inquiry$pro2 = response.inquiry.property_manager) === null || _response$inquiry$pro2 === void 0 ? void 0 : _response$inquiry$pro2.last_name) || 'Manager'),\n            property: ((_response$inquiry$pro3 = response.inquiry.property) === null || _response$inquiry$pro3 === void 0 ? void 0 : _response$inquiry$pro3.title) || ((_response$inquiry$pro4 = response.inquiry.property) === null || _response$inquiry$pro4 === void 0 ? void 0 : _response$inquiry$pro4.building_name) || 'Property',\n            propertyId: response.inquiry.property_id,\n            unitId: response.inquiry.unit_id || response.inquiry.property_id,\n            unitName: initialChat.unitName || response.inquiry.unit_name || ((_response$inquiry$pro5 = response.inquiry.property) === null || _response$inquiry$pro5 === void 0 ? void 0 : _response$inquiry$pro5.title) || ((_response$inquiry$pro6 = response.inquiry.property) === null || _response$inquiry$pro6 === void 0 ? void 0 : _response$inquiry$pro6.building_name) || 'Property',\n            avatar: 'ðŸ¢',\n            status: response.inquiry.status,\n            // Don't show the placeholder message in chat - start with empty messages array\n            messages: [],\n            inquiry: response.inquiry\n          };\n\n          // Add to chats and select it\n          setChats(prev => {\n            // Remove any duplicate for this property\n            const filtered = prev.filter(c => Number(c.propertyId) !== Number(newChat.propertyId));\n            return [...filtered, newChat];\n          });\n          setSelectedChatId(newChat.id);\n\n          // Pre-fill message with the actual message user should send (ready-to-send, not auto-sent)\n          const preFillMsg = `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n\n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = msg => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', {\n                bubbles: true\n              });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n\n          // Clear first, then set the message multiple times\n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n\n          // Reload inquiries after a delay to ensure everything is in sync\n          setTimeout(async () => {\n            await loadInquiries();\n            // Ensure the chat is still selected and message is set after reload\n            setSelectedChatId(newChat.id);\n            setTimeout(() => forceSetMessage(preFillMsg), 100);\n          }, 300);\n        } else if (response && response.message === 'Inquiry already exists' && response.inquiry) {\n          var _response$inquiry$pro7, _response$inquiry$pro8, _response$inquiry$pro9, _response$inquiry$pro0, _response$inquiry$pro1, _response$inquiry$pro10;\n          // Select the existing inquiry\n          const existingChat = {\n            id: response.inquiry.id,\n            managerName: (((_response$inquiry$pro7 = response.inquiry.property_manager) === null || _response$inquiry$pro7 === void 0 ? void 0 : _response$inquiry$pro7.first_name) || 'Property') + ' ' + (((_response$inquiry$pro8 = response.inquiry.property_manager) === null || _response$inquiry$pro8 === void 0 ? void 0 : _response$inquiry$pro8.last_name) || 'Manager'),\n            property: ((_response$inquiry$pro9 = response.inquiry.property) === null || _response$inquiry$pro9 === void 0 ? void 0 : _response$inquiry$pro9.title) || ((_response$inquiry$pro0 = response.inquiry.property) === null || _response$inquiry$pro0 === void 0 ? void 0 : _response$inquiry$pro0.building_name) || 'Property',\n            propertyId: response.inquiry.property_id,\n            unitId: response.inquiry.unit_id || response.inquiry.property_id,\n            unitName: initialChat.unitName || response.inquiry.unit_name || ((_response$inquiry$pro1 = response.inquiry.property) === null || _response$inquiry$pro1 === void 0 ? void 0 : _response$inquiry$pro1.title) || ((_response$inquiry$pro10 = response.inquiry.property) === null || _response$inquiry$pro10 === void 0 ? void 0 : _response$inquiry$pro10.building_name) || 'Property',\n            avatar: 'ðŸ¢',\n            status: response.inquiry.status,\n            messages: function () {\n              const inq = response.inquiry;\n              // Use regex to properly split messages with timestamp support\n              const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n              const parts = [];\n              let lastIndex = 0;\n              let match;\n              let timestamps = [];\n              while ((match = regex.exec(String(inq.message || ''))) !== null) {\n                const textBefore = String(inq.message || '').slice(lastIndex, match.index);\n                if (textBefore.trim()) {\n                  parts.push({\n                    text: textBefore,\n                    ts: timestamps[parts.length] || null\n                  });\n                }\n                timestamps.push(match[1] ? Number(match[1]) : null);\n                lastIndex = match.index + match[0].length;\n              }\n              const tail = String(inq.message || '').slice(lastIndex);\n              if (tail.trim()) {\n                parts.push({\n                  text: tail,\n                  ts: timestamps[parts.length] || null\n                });\n              }\n              const nowMs = Date.now();\n              const startMs = nowMs - Math.max(0, parts.length - 1) * 60000;\n              return parts.map((p, idx) => {\n                // Clean the text - remove any separator prefixes\n                let cleanText = p.text || '';\n                cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                // Skip empty messages\n                if (!cleanText) return null;\n\n                // Filter out placeholder messages\n                const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n                if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n                  return null;\n                }\n                return {\n                  id: `${inq.id}-t-${idx}`,\n                  sender: 'tenant',\n                  text: cleanText,\n                  time: new Date(p.ts || startMs + idx * 60000).toLocaleTimeString()\n                };\n              }).filter(Boolean); // Remove null entries\n            }(),\n            inquiry: response.inquiry\n          };\n          setChats(prev => {\n            // Remove any duplicate for this property\n            const filtered = prev.filter(c => Number(c.propertyId) !== Number(existingChat.propertyId));\n            return [...filtered, existingChat];\n          });\n          setSelectedChatId(existingChat.id);\n\n          // Pre-fill message - use a more aggressive approach\n          const preFillMsg = existingChat.messages && existingChat.messages.length > 0 ? `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?` : `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n\n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = msg => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', {\n                bubbles: true\n              });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n        }\n      } catch (err) {\n        console.error('Failed to create inquiry:', err);\n        if (err.status === 401) {\n          setError('Please log in to create an inquiry.');\n        } else if (err.status === 500) {\n          setError('Server error. Please try again later.');\n        } else {\n          setError('Failed to create inquiry. Please try again.');\n        }\n      } finally {\n        setLoading(false);\n      }\n    };\n    ensureInquiry();\n  }, [initialChat]);\n  const selectedChat = useMemo(() => chats.find(c => c.id === selectedChatId) || null, [chats, selectedChatId]);\n\n  // Pre-fill message when a chat matching initialChat is selected (multiple attempts for reliability)\n  useEffect(() => {\n    if (!initialChat || !selectedChatId) return;\n\n    // Check if selected chat matches initialChat property\n    const matchedChat = chats.find(c => c.id === selectedChatId && Number(c.propertyId) === Number(initialChat.propertyId));\n    if (!matchedChat) return;\n\n    // Only pre-fill once per chat\n    if (preFilledMessageRef.current.has(selectedChatId)) return;\n\n    // Set message with multiple attempts to ensure it gets set\n    const attemptSetMessage = () => {\n      setMessage(current => {\n        // Only set if message is currently empty\n        if (current.trim()) return current;\n\n        // Determine message based on chat state\n        if (matchedChat.messages && matchedChat.messages.length > 0) {\n          preFilledMessageRef.current.add(selectedChatId);\n          return `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?`;\n        } else {\n          preFilledMessageRef.current.add(selectedChatId);\n          return `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n        }\n      });\n    };\n\n    // Try immediately\n    attemptSetMessage();\n\n    // Try again after a short delay as fallback\n    const timeout1 = setTimeout(attemptSetMessage, 100);\n    const timeout2 = setTimeout(attemptSetMessage, 300);\n    return () => {\n      clearTimeout(timeout1);\n      clearTimeout(timeout2);\n    };\n  }, [selectedChatId, chats, initialChat]);\n  const handleSendMessage = async () => {\n    if (!message.trim() || !selectedChat) return;\n    try {\n      setLoading(true);\n      const response = await api.sendTenantMessage(selectedChat.id, message.trim());\n      if (response && response.success) {\n        // Add the message to the chat\n        setChats(prev => prev.map(c => c.id === selectedChat.id ? {\n          ...c,\n          messages: [...c.messages, {\n            id: Date.now(),\n            sender: 'tenant',\n            text: message.trim(),\n            time: new Date().toLocaleTimeString([], {\n              hour: 'numeric',\n              minute: '2-digit'\n            })\n          }]\n        } : c));\n        setMessage('');\n\n        // Reload to get updated data\n        await loadInquiries();\n      } else {\n        setError('Failed to send message. Please try again.');\n      }\n    } catch (err) {\n      console.error('Failed to send message:', err);\n      setError('Failed to send message. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleFileSelect = e => {\n    const files = Array.from(e.target.files);\n    setSelectedFiles(files);\n  };\n  const handleFileUpload = async () => {\n    if (!selectedFiles.length || !selectedChat) return;\n    try {\n      setUploadingFiles(true);\n      const response = await api.uploadInquiryAttachments(selectedChat.id, selectedFiles);\n      if (response && response.attachments) {\n        // Update attachments for this inquiry\n        setAttachments(prev => ({\n          ...prev,\n          [selectedChat.id]: [...(prev[selectedChat.id] || []), ...response.attachments]\n        }));\n        setSelectedFiles([]);\n        if (fileInputRef.current) fileInputRef.current.value = '';\n\n        // Reload to get updated data\n        await loadInquiries();\n      } else {\n        setError('Failed to upload files. Please try again.');\n      }\n    } catch (err) {\n      console.error('Failed to upload files:', err);\n      setError('Failed to upload files. Please try again.');\n    } finally {\n      setUploadingFiles(false);\n    }\n  };\n  const handleDownloadAttachment = async (attachmentId, fileName) => {\n    try {\n      const blob = await api.downloadInquiryAttachment(attachmentId);\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = fileName;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n    } catch (err) {\n      console.error('Failed to download attachment:', err);\n      setError('Failed to download file. Please try again.');\n    }\n  };\n  const handleDeleteAttachment = async (attachmentId, inquiryId) => {\n    if (!window.confirm('Are you sure you want to delete this file?')) return;\n    try {\n      await api.deleteInquiryAttachment(attachmentId);\n      setAttachments(prev => ({\n        ...prev,\n        [inquiryId]: (prev[inquiryId] || []).filter(att => att.id !== attachmentId)\n      }));\n\n      // Reload to get updated data\n      await loadInquiries();\n    } catch (err) {\n      console.error('Failed to delete attachment:', err);\n      setError('Failed to delete file. Please try again.');\n    }\n  };\n  const handleKeyPress = e => {\n    if (e.key === 'Enter') handleSendMessage();\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-3 z-50\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-xl w-full max-w-6xl max-h-[90vh] shadow-2xl overflow-hidden\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: onClose,\n            className: \"w-9 h-9 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-all duration-300 shadow-lg\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-4 h-4 text-white\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M15 19l-7-7 7-7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 670,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 669,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 665,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n              className: \"text-lg font-black text-black\",\n              children: \"My Property Inquiries\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 674,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-xs text-gray-500\",\n              children: \"Chat with property managers about available properties\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 675,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 673,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 664,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 663,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-red-50 border-l-4 border-red-400 p-4 mx-4 mt-2\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ml-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm text-red-700\",\n              children: error\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 685,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setError(null),\n              className: \"text-xs text-red-600 underline mt-1\",\n              children: \"Dismiss\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 686,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 684,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 683,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 682,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex h-[calc(90vh-72px)]\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-80 border-r border-gray-200 bg-gray-50\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex border-b border-gray-200\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {},\n              className: `flex-1 py-3 px-4 text-sm font-medium transition-colors ${'bg-white text-black border-b-2 border-black'}`,\n              children: \"Active Chats\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 703,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {},\n              className: `flex-1 py-3 px-4 text-sm font-medium transition-colors ${'text-gray-600 hover:text-black hover:bg-gray-100'}`,\n              children: \"New Properties\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 711,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 702,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"relative\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\",\n                children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"h-4 w-4 text-gray-400\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: 2,\n                    d: \"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 726,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 725,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 724,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                placeholder: \"Search chats...\",\n                className: \"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-sm\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 729,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 723,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 722,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 overflow-y-auto\",\n            children: loading && chats.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-4 text-center\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"animate-spin rounded-full h-8 w-8 border-b-2 border-black mx-auto\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 742,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm text-gray-500 mt-2\",\n                children: \"Loading inquiries...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 743,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 741,\n              columnNumber: 17\n            }, this) :\n            /*#__PURE__*/\n            /* Active Chats */\n            _jsxDEV(\"div\", {\n              className: \"space-y-1 px-2\",\n              children: chats.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"p-4 text-sm text-gray-500\",\n                children: \"No conversations yet. Start an inquiry from a unit to chat with a manager.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 749,\n                columnNumber: 19\n              }, this) : chats.map(chat => {\n                var _chat$messages, _chat$messages2;\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  onClick: () => setSelectedChatId(chat.id),\n                  className: `p-3 rounded-lg cursor-pointer transition-colors ${selectedChatId === chat.id ? 'bg-gray-200' : 'hover:bg-gray-100'}`,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"flex items-center space-x-3\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"relative\",\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\",\n                        children: /*#__PURE__*/_jsxDEV(\"span\", {\n                          className: \"text-sm font-medium text-blue-600\",\n                          children: chat.avatar\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 762,\n                          columnNumber: 29\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 761,\n                        columnNumber: 27\n                      }, this), chat.status === 'online' && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 765,\n                        columnNumber: 29\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 760,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"flex-1 min-w-0\",\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"flex items-center justify-between\",\n                        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                          className: \"text-sm font-medium text-gray-900 truncate\",\n                          children: chat.managerName\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 770,\n                          columnNumber: 29\n                        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                          className: \"text-xs text-gray-500\",\n                          children: (_chat$messages = chat.messages[chat.messages.length - 1]) === null || _chat$messages === void 0 ? void 0 : _chat$messages.time\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 771,\n                          columnNumber: 29\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 769,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                        className: \"text-xs text-gray-600 truncate\",\n                        children: chat.property\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 773,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                        className: \"text-xs text-gray-500 truncate\",\n                        children: String(((_chat$messages2 = chat.messages[chat.messages.length - 1]) === null || _chat$messages2 === void 0 ? void 0 : _chat$messages2.text) || '').replace(/---\\s*Manager Reply\\s*\\[\\d{10,}\\]\\s*---/g, '').replace(/---\\s*New Message\\s*(?:\\[\\d{10,}\\])?\\s*---/g, '')\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 774,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 768,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 759,\n                    columnNumber: 23\n                  }, this)\n                }, chat.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 752,\n                  columnNumber: 21\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 747,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 738,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 700,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1 flex flex-col bg-white\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-between p-4 border-b border-gray-200\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"relative\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\",\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-sm font-medium text-blue-600\",\n                    children: (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.avatar) || 'PM'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 796,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 795,\n                  columnNumber: 19\n                }, this), (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.status) === 'online' && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 801,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 794,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                  className: \"text-sm font-medium text-gray-900\",\n                  children: (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.managerName) || 'Property Manager'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 805,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-xs text-gray-500\",\n                  children: (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.unitName) || (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.property) || 'Property'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 808,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 804,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 793,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"p-2 text-gray-500 hover:text-black hover:bg-gray-100 rounded-lg transition-colors\",\n                children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-4 h-4\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: 2,\n                    d: \"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 816,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 815,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 814,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"p-2 text-gray-500 hover:text-black hover:bg-gray-100 rounded-lg transition-colors\",\n                children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-4 h-4\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: 2,\n                    d: \"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 821,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 820,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 819,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 813,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 792,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 overflow-y-auto p-4 space-y-4\",\n            children: selectedChat === null || selectedChat === void 0 ? void 0 : (_selectedChat$message = selectedChat.messages) === null || _selectedChat$message === void 0 ? void 0 : _selectedChat$message.map(msg => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `flex ${msg.sender === 'tenant' ? 'justify-end' : 'justify-start'}`,\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${msg.sender === 'tenant' ? 'bg-black text-white' : 'bg-gray-200 text-gray-900'}`,\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm\",\n                  children: msg.text\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 841,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: `text-xs mt-1 ${msg.sender === 'tenant' ? 'text-gray-300' : 'text-gray-500'}`,\n                  children: msg.time\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 842,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 834,\n                columnNumber: 19\n              }, this)\n            }, msg.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 830,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 828,\n            columnNumber: 13\n          }, this), selectedChat && attachments[selectedChat.id] && attachments[selectedChat.id].length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"px-4 py-2 border-t border-gray-200 bg-gray-50\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-xs text-gray-600 mb-2 font-medium\",\n              children: \"Attachments:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 855,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex flex-wrap gap-2\",\n              children: attachments[selectedChat.id].map(att => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center space-x-2 bg-white px-3 py-2 rounded-lg border border-gray-200\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-sm text-gray-700 truncate max-w-[150px]\",\n                  children: att.file_name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 859,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => handleDownloadAttachment(att.id, att.file_name),\n                  className: \"text-blue-600 hover:text-blue-800 text-sm\",\n                  children: \"Download\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 860,\n                  columnNumber: 23\n                }, this)]\n              }, att.id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 858,\n                columnNumber: 21\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 856,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 854,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4 border-t border-gray-200\",\n            children: [selectedFiles.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-2 flex flex-wrap gap-2\",\n              children: [selectedFiles.map((file, idx) => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center space-x-2 bg-gray-100 px-3 py-1 rounded-lg text-sm\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-gray-700\",\n                  children: file.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 879,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => setSelectedFiles(prev => prev.filter((_, i) => i !== idx)),\n                  className: \"text-red-600 hover:text-red-800\",\n                  children: \"\\xD7\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 880,\n                  columnNumber: 23\n                }, this)]\n              }, idx, true, {\n                fileName: _jsxFileName,\n                lineNumber: 878,\n                columnNumber: 21\n              }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: handleFileUpload,\n                disabled: uploadingFiles,\n                className: \"bg-blue-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50\",\n                children: uploadingFiles ? 'Uploading...' : 'Upload'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 888,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 876,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                ref: fileInputRef,\n                type: \"file\",\n                multiple: true,\n                accept: \"image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx\",\n                onChange: handleFileSelect,\n                className: \"hidden\",\n                id: \"file-input\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 899,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: \"file-input\",\n                className: \"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors cursor-pointer\",\n                children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-5 h-5 text-gray-600\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: 2,\n                    d: \"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 913,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 912,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 908,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                ref: messageInputRef,\n                type: \"text\",\n                value: message || '',\n                onChange: e => setMessage(e.target.value),\n                onKeyPress: handleKeyPress,\n                placeholder: \"Type your message to the property manager...\",\n                className: \"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-black placeholder-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 916,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: handleSendMessage,\n                disabled: loading || !message.trim(),\n                className: \"w-10 h-10 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\",\n                children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 931,\n                  columnNumber: 21\n                }, this) : /*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-5 h-5 text-white\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: 2,\n                    d: \"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 934,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 933,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 925,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 898,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-xs text-gray-500 mt-2 text-center\",\n              children: [\"You're chatting with the property manager about \", (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.unitName) || (selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.property) || 'this unit']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 939,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 873,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 790,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 698,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 661,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 660,\n    columnNumber: 5\n  }, this);\n};\n_s(Inquiries, \"5zqwjQtZcVdxILD57d4+iijSKgM=\");\n_c = Inquiries;\nexport default Inquiries;\nvar _c;\n$RefreshReg$(_c, \"Inquiries\");","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","api","jsxDEV","_jsxDEV","Inquiries","onClose","initialChat","_s","_selectedChat$message","message","setMessage","chats","setChats","selectedChatId","setSelectedChatId","loading","setLoading","error","setError","uploadingFiles","setUploadingFiles","selectedFiles","setSelectedFiles","attachments","setAttachments","hydratedRef","preFilledMessageRef","Set","messageInputRef","fileInputRef","loadInquiries","accessToken","localStorage","getItem","response","getTenantInquiries","inquiries","toMessages","inq","regex","chunks","lastIndex","match","exec","String","ts","Number","text","slice","index","push","length","tail","parts","pendingTs","c","msgs","map","p","idx","cleanText","replace","trim","placeholderPatterns","some","pattern","test","id","sender","time","Date","now","toLocaleTimeString","hour","minute","filter","Boolean","response_message","mSep","mSrc","mParts","mLast","mm","txt","mTail","mPending","part","messages","Array","isArray","newFormatMsgs","msg","sender_id","tenant_id","created_at","allMsgs","uniqueMsgs","seenTexts","textKey","has","add","sort","a","b","timeA","getTime","timeB","mapped","inquiry","_inquiry$property_man","_inquiry$property_man2","_inquiry$property","_inquiry$property2","_inquiry$property3","_inquiry$property4","managerName","property_manager","first_name","last_name","property","title","building_name","propertyId","property_id","unitId","unit_id","unitName","unit_name","avatar","status","dedup","seen","key","chat","attData","getInquiryAttachments","prev","err","console","current","setItem","JSON","stringify","_","ensureInquiry","existing","res","parser","last","m","out","pending","cleanReply","responded_at","_inquiry$property_man3","_inquiry$property_man4","_inquiry$property5","_inquiry$property6","_inquiry$property7","_inquiry$property8","find","preFillMsg","forceSetMessage","value","event","Event","bubbles","dispatchEvent","setTimeout","placeholderMessage","startTenantInquiry","_response$inquiry$pro","_response$inquiry$pro2","_response$inquiry$pro3","_response$inquiry$pro4","_response$inquiry$pro5","_response$inquiry$pro6","newChat","filtered","_response$inquiry$pro7","_response$inquiry$pro8","_response$inquiry$pro9","_response$inquiry$pro0","_response$inquiry$pro1","_response$inquiry$pro10","existingChat","timestamps","textBefore","nowMs","startMs","Math","max","selectedChat","matchedChat","attemptSetMessage","timeout1","timeout2","clearTimeout","handleSendMessage","sendTenantMessage","success","handleFileSelect","e","files","from","target","handleFileUpload","uploadInquiryAttachments","handleDownloadAttachment","attachmentId","fileName","blob","downloadInquiryAttachment","url","window","URL","createObjectURL","document","createElement","href","download","body","appendChild","click","revokeObjectURL","removeChild","handleDeleteAttachment","inquiryId","confirm","deleteInquiryAttachment","att","handleKeyPress","className","children","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","_jsxFileName","lineNumber","columnNumber","type","placeholder","_chat$messages","_chat$messages2","file_name","file","name","i","disabled","ref","multiple","accept","onChange","htmlFor","onKeyPress","_c","$RefreshReg$"],"sources":["C:/Users/Lenovo/OneDrive/Desktop/Capstone-Project-jun/main-domain/frontend/src/components/Tenants/Inquiries.js"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport api from '../../services/api';\n\n// Props:\n// - onClose(): close modal\n// - initialChat: { id?, managerName, property, unitId, propertyId }\nconst Inquiries = ({ onClose, initialChat = null }) => {\n  const [message, setMessage] = useState('');\n  const [chats, setChats] = useState([]); // [{id, managerName, property, avatar, status, messages: [{id, sender, text, time}]}]\n  const [selectedChatId, setSelectedChatId] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [uploadingFiles, setUploadingFiles] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState([]);\n  const [attachments, setAttachments] = useState({}); // {inquiryId: [attachments]}\n  const hydratedRef = useRef(false);\n  const preFilledMessageRef = useRef(new Set()); // Track which chats have had messages pre-filled\n  const messageInputRef = useRef(null); // Reference to the message input element\n  const fileInputRef = useRef(null);\n\n  // Load inquiries from backend API\n  const loadInquiries = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      // Check if user is authenticated\n      const accessToken = localStorage.getItem('access_token') || localStorage.getItem('token');\n      if (!accessToken) {\n        setError('Please log in to view your inquiries.');\n        setLoading(false);\n        return;\n      }\n      \n      const response = await api.getTenantInquiries();\n      if (response && response.inquiries) {\n        // Helper: explode concatenated text (tenant + manager) into chronological bubbles with embedded timestamps\n        const toMessages = (inq) => {\n          const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n          const chunks = [];\n          let lastIndex = 0;\n          let match;\n          while ((match = regex.exec(String(inq.message || ''))) !== null) {\n            const ts = match[1] ? Number(match[1]) : null;\n            const text = String(inq.message || '').slice(lastIndex, match.index);\n            if (text) chunks.push({ text, ts: null });\n            lastIndex = match.index + match[0].length;\n            // next text will carry ts via subsequent slice\n            chunks.push({ text: null, ts });\n          }\n          const tail = String(inq.message || '').slice(lastIndex);\n          if (tail) chunks.push({ text: tail, ts: null });\n\n          // Merge markers (ts) with following text blocks\n          const parts = [];\n          let pendingTs = null;\n          for (const c of chunks) {\n            if (c.text === null && c.ts) {\n              pendingTs = c.ts;\n            } else if (c.text) {\n              parts.push({ text: c.text, ts: pendingTs });\n              pendingTs = null;\n            }\n          }\n\n          const msgs = parts.map((p, idx) => {\n            // Clean the text - remove any separator prefixes that might still be present\n            let cleanText = p.text || '';\n            // Remove any remaining \"--- New Message [timestamp] ---\" prefixes\n            cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n            // Remove any at the end too\n            cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n            // Skip empty messages after cleaning\n            if (!cleanText) return null;\n            \n            // Filter out placeholder messages (don't show them in chat)\n            const placeholderPatterns = [\n              /^inquiry\\s+started$/i,\n              /^placeholder$/i,\n              /^init$/i\n            ];\n            if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n              return null;\n            }\n            \n            return {\n              id: `${inq.id}-t-${idx}`,\n              sender: 'tenant',\n              text: cleanText,\n              time: new Date(p.ts || Date.now()).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })\n            };\n          }).filter(Boolean); // Remove null entries\n\n          // Also explode manager replies stored in response_message using timestamped delimiters\n          // Note: This is for backward compatibility. New system uses inquiry_messages table\n          if (inq.response_message) {\n            const mSep = /\\n\\n--- Manager Reply \\[(\\d{10,})\\] ---\\n/g;\n            const mSrc = String(inq.response_message || '');\n            const mParts = []; let mLast = 0; let mm;\n            while ((mm = mSep.exec(mSrc)) !== null) {\n              const txt = mSrc.slice(mLast, mm.index);\n              if (txt) mParts.push({ text: txt, ts: null });\n              mParts.push({ text: null, ts: mm[1] ? Number(mm[1]) : null });\n              mLast = mm.index + mm[0].length;\n            }\n            const mTail = mSrc.slice(mLast); if (mTail) mParts.push({ text: mTail, ts: null });\n            let mPending = null; const now = Date.now();\n            for (const part of mParts) {\n              if (part.text === null) { mPending = part.ts; continue; }\n              // Clean manager reply text - remove any separator prefixes\n              let cleanText = part.text || '';\n              cleanText = cleanText.replace(/^---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n              cleanText = cleanText.replace(/\\s*---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n              // Skip empty messages after cleaning\n              if (!cleanText) continue;\n              \n              msgs.push({ \n                id: `${inq.id}-m-${msgs.length}`, \n                sender: 'manager', \n                text: cleanText, \n                time: new Date(mPending || now).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' }) \n              });\n              mPending = null;\n            }\n          }\n          \n          // Also check for messages from inquiry_messages table if available (new format)\n          if (inq.messages && Array.isArray(inq.messages) && inq.messages.length > 0) {\n            // Use messages from inquiry_messages table as primary source\n            // These are already properly formatted by the backend\n            const newFormatMsgs = inq.messages.map(msg => ({\n              id: `msg-${msg.id}`,\n              sender: msg.sender || (msg.sender_id === inq.tenant_id ? 'tenant' : 'manager'),\n              text: msg.message || msg.text || '',\n              time: msg.created_at \n                ? new Date(msg.created_at).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })\n                : new Date().toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })\n            }));\n            \n            // If we have new format messages, use them instead of parsed old format\n            // Merge with any old format messages that might not be in the new table yet\n            const allMsgs = [...msgs, ...newFormatMsgs];\n            \n            // Remove duplicates based on text content and sort by time\n            const uniqueMsgs = [];\n            const seenTexts = new Set();\n            for (const msg of allMsgs) {\n              const textKey = `${msg.sender}-${msg.text}`;\n              if (!seenTexts.has(textKey)) {\n                seenTexts.add(textKey);\n                uniqueMsgs.push(msg);\n              }\n            }\n            \n            // Sort by created_at if available, otherwise by time string\n            uniqueMsgs.sort((a, b) => {\n              // Try to get timestamp from message object if available\n              const timeA = a.created_at ? new Date(a.created_at).getTime() : \n                           (a.time ? new Date(`2000-01-01 ${a.time}`).getTime() : 0);\n              const timeB = b.created_at ? new Date(b.created_at).getTime() : \n                           (b.time ? new Date(`2000-01-01 ${b.time}`).getTime() : 0);\n              return timeA - timeB;\n            });\n            \n            return uniqueMsgs;\n          }\n          return msgs;\n        };\n\n        // Map and de-duplicate by propertyId\n        const mapped = response.inquiries.map(inquiry => ({\n          id: inquiry.id,\n          managerName: (inquiry.property_manager?.first_name || 'Property') + ' ' + (inquiry.property_manager?.last_name || 'Manager'),\n          property: inquiry.property?.title || inquiry.property?.building_name || 'Property',\n          propertyId: inquiry.property_id,\n          unitId: inquiry.unit_id || inquiry.property_id,\n          unitName: inquiry.unit_name || inquiry.property?.title || inquiry.property?.building_name || 'Property',\n          avatar: 'ðŸ¢',\n          status: inquiry.status,\n          messages: toMessages(inquiry),\n          attachments: inquiry.attachments || [],\n          inquiry\n        }));\n        const dedup = [];\n        const seen = new Set();\n        for (const c of mapped) {\n          const key = String(c.propertyId);\n          if (seen.has(key)) continue;\n          seen.add(key);\n          dedup.push(c);\n        }\n        setChats(dedup);\n        \n        // Load attachments for all inquiries\n        for (const chat of dedup) {\n          try {\n            const attData = await api.getInquiryAttachments(chat.id);\n            if (attData && attData.attachments) {\n              setAttachments(prev => ({ ...prev, [chat.id]: attData.attachments }));\n            }\n          } catch (err) {\n            console.error(`Failed to load attachments for inquiry ${chat.id}:`, err);\n          }\n        }\n      }\n    } catch (err) {\n      console.error('Failed to load inquiries:', err);\n      if (err.status === 401) {\n        setError('Please log in to view your inquiries.');\n        // Optionally redirect to login\n        // window.location.href = '/login';\n      } else {\n        setError('Failed to load inquiries. Please try again.');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Load inquiries on mount\n  useEffect(() => {\n    loadInquiries();\n      hydratedRef.current = true;\n  }, []);\n\n  // Persist chats and selection whenever they change\n  useEffect(() => {\n    if (!hydratedRef.current) return; // avoid wiping storage with initial empty state\n    try {\n      if (Array.isArray(chats)) localStorage.setItem('tenant_chats', JSON.stringify(chats));\n      if (selectedChatId) {\n        localStorage.setItem('tenant_selected_chat_id', selectedChatId);\n      }\n    } catch (_) {\n      // storage may be unavailable\n    }\n  }, [chats, selectedChatId]);\n\n  // Create or reuse inquiry when opened from \"INQUIRE NOW\"\n  useEffect(() => {\n    if (!initialChat || !initialChat.propertyId) return;\n\n    const ensureInquiry = async () => {\n      try {\n        setLoading(true);\n        // 1) Load current inquiries to avoid duplicates\n        let existing = chats;\n        if (!Array.isArray(existing) || existing.length === 0) {\n          try {\n            const res = await api.getTenantInquiries();\n            if (res && Array.isArray(res.inquiries)) {\n              // Reuse the same parser as in main load\n              const parser = (inq) => {\n                const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n                const chunks = []; let last = 0; let m;\n                while ((m = regex.exec(String(inq.message || ''))) !== null) {\n                  const txt = String(inq.message || '').slice(last, m.index);\n                  if (txt) chunks.push({ text: txt, ts: null });\n                  chunks.push({ text: null, ts: m[1] ? Number(m[1]) : null });\n                  last = m.index + m[0].length;\n                }\n                const tail = String(inq.message || '').slice(last);\n                if (tail) chunks.push({ text: tail, ts: null });\n                const out = []; let pending = null; const now = Date.now();\n                for (const c of chunks) {\n                  if (c.text === null) { pending = c.ts; continue; }\n                  // Clean the text - remove any separator prefixes\n                  let cleanText = c.text || '';\n                  cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                  cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                  // Skip empty messages after cleaning\n                  if (!cleanText) continue;\n                  \n                  // Filter out placeholder messages\n                  const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n                  if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n                    continue;\n                  }\n                  \n                  out.push({ id: `${inq.id}-t-${out.length}`, sender: 'tenant', text: cleanText, time: new Date(pending || now).toLocaleTimeString() });\n                  pending = null;\n                }\n                if (inq.response_message) {\n                  // Clean manager reply too\n                  let cleanReply = String(inq.response_message || '').replace(/^---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                  cleanReply = cleanReply.replace(/\\s*---\\s*Manager\\s*Reply\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                  if (cleanReply) {\n                    out.push({ id: `${inq.id}-m`, sender: 'manager', text: cleanReply, time: new Date(inq.responded_at || now).toLocaleTimeString() });\n                  }\n                }\n                return out;\n              };\n\n              const mapped = res.inquiries.map(inquiry => ({\n                id: inquiry.id,\n                managerName: (inquiry.property_manager?.first_name || 'Property') + ' ' + (inquiry.property_manager?.last_name || 'Manager'),\n                property: inquiry.property?.title || inquiry.property?.building_name || 'Property',\n                propertyId: inquiry.property_id,\n                unitId: inquiry.unit_id || inquiry.property_id,\n                unitName: inquiry.unit_name || inquiry.property?.title || inquiry.property?.building_name || 'Property',\n                avatar: 'ðŸ¢',\n                status: inquiry.status,\n                messages: parser(inquiry),\n                inquiry\n              }));\n              existing = mapped;\n              setChats(mapped);\n            }\n          } catch (_) { /* ignore load errors here */ }\n        }\n\n        // 2) If an inquiry for this property already exists, just select it and pre-fill message\n        const match = (existing || []).find(c => Number(c.propertyId) === Number(initialChat.propertyId));\n        if (match) {\n          setSelectedChatId(match.id);\n          \n          // Pre-fill message - use a more aggressive approach\n          const preFillMsg = match.messages && match.messages.length > 0\n            ? `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?`\n            : `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n          \n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = (msg) => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', { bubbles: true });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          \n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n          \n          return;\n        }\n\n        // 3) Otherwise, create one - send a minimal placeholder message (required by backend) but don't display it\n        // Instead, pre-fill the text box with the actual message for user to send manually\n        const placeholderMessage = \"Inquiry started\"; // Minimal message required by backend\n        const response = await api.startTenantInquiry(\n          initialChat.propertyId,\n          placeholderMessage,\n          initialChat.unitId || null\n        );\n\n        if (response && response.inquiry) {\n          const newChat = {\n            id: response.inquiry.id,\n            managerName: (response.inquiry.property_manager?.first_name || 'Property') + ' ' + (response.inquiry.property_manager?.last_name || 'Manager'),\n            property: response.inquiry.property?.title || response.inquiry.property?.building_name || 'Property',\n            propertyId: response.inquiry.property_id,\n            unitId: response.inquiry.unit_id || response.inquiry.property_id,\n            unitName: initialChat.unitName || response.inquiry.unit_name || response.inquiry.property?.title || response.inquiry.property?.building_name || 'Property',\n            avatar: 'ðŸ¢',\n            status: response.inquiry.status,\n            // Don't show the placeholder message in chat - start with empty messages array\n            messages: [],\n            inquiry: response.inquiry\n          };\n          \n          // Add to chats and select it\n          setChats(prev => {\n            // Remove any duplicate for this property\n            const filtered = prev.filter(c => Number(c.propertyId) !== Number(newChat.propertyId));\n            return [...filtered, newChat];\n          });\n          setSelectedChatId(newChat.id);\n          \n          // Pre-fill message with the actual message user should send (ready-to-send, not auto-sent)\n          const preFillMsg = `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n          \n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = (msg) => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', { bubbles: true });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          \n          // Clear first, then set the message multiple times\n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n          \n          // Reload inquiries after a delay to ensure everything is in sync\n          setTimeout(async () => {\n            await loadInquiries();\n            // Ensure the chat is still selected and message is set after reload\n            setSelectedChatId(newChat.id);\n            setTimeout(() => forceSetMessage(preFillMsg), 100);\n          }, 300);\n        }\n        else if (response && response.message === 'Inquiry already exists' && response.inquiry) {\n          // Select the existing inquiry\n          const existingChat = {\n            id: response.inquiry.id,\n            managerName: (response.inquiry.property_manager?.first_name || 'Property') + ' ' + (response.inquiry.property_manager?.last_name || 'Manager'),\n            property: response.inquiry.property?.title || response.inquiry.property?.building_name || 'Property',\n            propertyId: response.inquiry.property_id,\n            unitId: response.inquiry.unit_id || response.inquiry.property_id,\n            unitName: initialChat.unitName || response.inquiry.unit_name || response.inquiry.property?.title || response.inquiry.property?.building_name || 'Property',\n            avatar: 'ðŸ¢',\n            status: response.inquiry.status,\n            messages: (function(){\n              const inq = response.inquiry;\n              // Use regex to properly split messages with timestamp support\n              const regex = /\\n\\n--- New Message(?: \\[(\\d{10,})\\])? ---\\n/g;\n              const parts = [];\n              let lastIndex = 0;\n              let match;\n              let timestamps = [];\n              \n              while ((match = regex.exec(String(inq.message || ''))) !== null) {\n                const textBefore = String(inq.message || '').slice(lastIndex, match.index);\n                if (textBefore.trim()) {\n                  parts.push({ text: textBefore, ts: timestamps[parts.length] || null });\n                }\n                timestamps.push(match[1] ? Number(match[1]) : null);\n                lastIndex = match.index + match[0].length;\n              }\n              \n              const tail = String(inq.message || '').slice(lastIndex);\n              if (tail.trim()) {\n                parts.push({ text: tail, ts: timestamps[parts.length] || null });\n              }\n              \n              const nowMs = Date.now();\n              const startMs = nowMs - (Math.max(0, parts.length - 1) * 60000);\n              \n              return parts.map((p, idx) => {\n                // Clean the text - remove any separator prefixes\n                let cleanText = p.text || '';\n                cleanText = cleanText.replace(/^---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*/gi, '').trim();\n                cleanText = cleanText.replace(/\\s*---\\s*New\\s*Message\\s*\\[?\\d*\\]?\\s*---\\s*$/gi, '').trim();\n                // Skip empty messages\n                if (!cleanText) return null;\n                \n                // Filter out placeholder messages\n                const placeholderPatterns = [/^inquiry\\s+started$/i, /^placeholder$/i, /^init$/i];\n                if (placeholderPatterns.some(pattern => pattern.test(cleanText))) {\n                  return null;\n                }\n                \n                return {\n                  id: `${inq.id}-t-${idx}`,\n                  sender: 'tenant',\n                  text: cleanText,\n                  time: new Date(p.ts || startMs + idx * 60000).toLocaleTimeString()\n                };\n              }).filter(Boolean); // Remove null entries\n            })(),\n            inquiry: response.inquiry\n          };\n          setChats(prev => {\n            // Remove any duplicate for this property\n            const filtered = prev.filter(c => Number(c.propertyId) !== Number(existingChat.propertyId));\n            return [...filtered, existingChat];\n          });\n          setSelectedChatId(existingChat.id);\n          \n          // Pre-fill message - use a more aggressive approach\n          const preFillMsg = existingChat.messages && existingChat.messages.length > 0\n            ? `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?`\n            : `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n          \n          // Force set multiple times to ensure it appears - use both state and direct DOM manipulation\n          const forceSetMessage = (msg) => {\n            setMessage(msg);\n            if (messageInputRef.current) {\n              messageInputRef.current.value = msg;\n              const event = new Event('input', { bubbles: true });\n              messageInputRef.current.dispatchEvent(event);\n            }\n          };\n          \n          forceSetMessage('');\n          setTimeout(() => forceSetMessage(preFillMsg), 10);\n          setTimeout(() => forceSetMessage(preFillMsg), 50);\n          setTimeout(() => forceSetMessage(preFillMsg), 100);\n          setTimeout(() => forceSetMessage(preFillMsg), 200);\n          setTimeout(() => forceSetMessage(preFillMsg), 400);\n        }\n      } catch (err) {\n        console.error('Failed to create inquiry:', err);\n        if (err.status === 401) {\n          setError('Please log in to create an inquiry.');\n        } else if (err.status === 500) {\n          setError('Server error. Please try again later.');\n        } else {\n          setError('Failed to create inquiry. Please try again.');\n        }\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    ensureInquiry();\n  }, [initialChat]);\n\n  const selectedChat = useMemo(() => chats.find(c => c.id === selectedChatId) || null, [chats, selectedChatId]);\n\n  // Pre-fill message when a chat matching initialChat is selected (multiple attempts for reliability)\n  useEffect(() => {\n    if (!initialChat || !selectedChatId) return;\n    \n    // Check if selected chat matches initialChat property\n    const matchedChat = chats.find(c => c.id === selectedChatId && Number(c.propertyId) === Number(initialChat.propertyId));\n    if (!matchedChat) return;\n    \n    // Only pre-fill once per chat\n    if (preFilledMessageRef.current.has(selectedChatId)) return;\n    \n    // Set message with multiple attempts to ensure it gets set\n    const attemptSetMessage = () => {\n      setMessage(current => {\n        // Only set if message is currently empty\n        if (current.trim()) return current;\n        \n        // Determine message based on chat state\n        if (matchedChat.messages && matchedChat.messages.length > 0) {\n          preFilledMessageRef.current.add(selectedChatId);\n          return `Hello! I'm still interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Could you please provide an update?`;\n        } else {\n          preFilledMessageRef.current.add(selectedChatId);\n          return `Hello! I'm interested in ${initialChat.unitName || initialChat.property || 'this unit'}. Please provide more information about availability, viewing options, and pricing details. Thank you!`;\n        }\n      });\n    };\n    \n    // Try immediately\n    attemptSetMessage();\n    \n    // Try again after a short delay as fallback\n    const timeout1 = setTimeout(attemptSetMessage, 100);\n    const timeout2 = setTimeout(attemptSetMessage, 300);\n    \n    return () => {\n      clearTimeout(timeout1);\n      clearTimeout(timeout2);\n    };\n  }, [selectedChatId, chats, initialChat]);\n\n  const handleSendMessage = async () => {\n    if (!message.trim() || !selectedChat) return;\n    \n    try {\n      setLoading(true);\n      const response = await api.sendTenantMessage(selectedChat.id, message.trim());\n      \n      if (response && response.success) {\n        // Add the message to the chat\n        setChats(prev => prev.map(c => c.id === selectedChat.id ? {\n          ...c,\n          messages: [...c.messages, { \n            id: Date.now(), \n            sender: 'tenant', \n            text: message.trim(), \n            time: new Date().toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' }) \n          }]\n        } : c));\n        setMessage('');\n        \n        // Reload to get updated data\n        await loadInquiries();\n      } else {\n        setError('Failed to send message. Please try again.');\n      }\n    } catch (err) {\n      console.error('Failed to send message:', err);\n      setError('Failed to send message. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleFileSelect = (e) => {\n    const files = Array.from(e.target.files);\n    setSelectedFiles(files);\n  };\n\n  const handleFileUpload = async () => {\n    if (!selectedFiles.length || !selectedChat) return;\n    \n    try {\n      setUploadingFiles(true);\n      const response = await api.uploadInquiryAttachments(selectedChat.id, selectedFiles);\n      \n      if (response && response.attachments) {\n        // Update attachments for this inquiry\n        setAttachments(prev => ({\n          ...prev,\n          [selectedChat.id]: [...(prev[selectedChat.id] || []), ...response.attachments]\n        }));\n        setSelectedFiles([]);\n        if (fileInputRef.current) fileInputRef.current.value = '';\n        \n        // Reload to get updated data\n        await loadInquiries();\n      } else {\n        setError('Failed to upload files. Please try again.');\n      }\n    } catch (err) {\n      console.error('Failed to upload files:', err);\n      setError('Failed to upload files. Please try again.');\n    } finally {\n      setUploadingFiles(false);\n    }\n  };\n\n  const handleDownloadAttachment = async (attachmentId, fileName) => {\n    try {\n      const blob = await api.downloadInquiryAttachment(attachmentId);\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = fileName;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n    } catch (err) {\n      console.error('Failed to download attachment:', err);\n      setError('Failed to download file. Please try again.');\n    }\n  };\n\n  const handleDeleteAttachment = async (attachmentId, inquiryId) => {\n    if (!window.confirm('Are you sure you want to delete this file?')) return;\n    \n    try {\n      await api.deleteInquiryAttachment(attachmentId);\n      setAttachments(prev => ({\n        ...prev,\n        [inquiryId]: (prev[inquiryId] || []).filter(att => att.id !== attachmentId)\n      }));\n      \n      // Reload to get updated data\n      await loadInquiries();\n    } catch (err) {\n      console.error('Failed to delete attachment:', err);\n      setError('Failed to delete file. Please try again.');\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') handleSendMessage();\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-3 z-50\">\n      <div className=\"bg-white rounded-xl w-full max-w-6xl max-h-[90vh] shadow-2xl overflow-hidden\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white\">\n          <div className=\"flex items-center space-x-3\">\n            <button\n              onClick={onClose}\n              className=\"w-9 h-9 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-all duration-300 shadow-lg\"\n            >\n              <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n              </svg>\n            </button>\n            <div>\n              <h1 className=\"text-lg font-black text-black\">My Property Inquiries</h1>\n              <p className=\"text-xs text-gray-500\">Chat with property managers about available properties</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Error Message */}\n        {error && (\n          <div className=\"bg-red-50 border-l-4 border-red-400 p-4 mx-4 mt-2\">\n            <div className=\"flex\">\n              <div className=\"ml-3\">\n                <p className=\"text-sm text-red-700\">{error}</p>\n                <button \n                  onClick={() => setError(null)}\n                  className=\"text-xs text-red-600 underline mt-1\"\n                >\n                  Dismiss\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Main Content */}\n        <div className=\"flex h-[calc(90vh-72px)]\">\n          {/* Left Panel - Chat List */}\n          <div className=\"w-80 border-r border-gray-200 bg-gray-50\">\n            {/* Tabs */}\n            <div className=\"flex border-b border-gray-200\">\n              <button\n                onClick={() => {}}\n                className={`flex-1 py-3 px-4 text-sm font-medium transition-colors ${\n                  'bg-white text-black border-b-2 border-black'\n                }`}\n              >\n                Active Chats\n              </button>\n              <button\n                onClick={() => {}}\n                className={`flex-1 py-3 px-4 text-sm font-medium transition-colors ${\n                  'text-gray-600 hover:text-black hover:bg-gray-100'\n                }`}\n              >\n                New Properties\n              </button>\n            </div>\n\n            {/* Search */}\n            <div className=\"p-4\">\n              <div className=\"relative\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <svg className=\"h-4 w-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n                  </svg>\n                </div>\n                <input\n                  type=\"text\"\n                  placeholder=\"Search chats...\"\n                  className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-sm\"\n                />\n              </div>\n            </div>\n\n            {/* Chat/Property List */}\n            <div className=\"flex-1 overflow-y-auto\">\n              {/* Loading State */}\n              {loading && chats.length === 0 ? (\n                <div className=\"p-4 text-center\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-black mx-auto\"></div>\n                  <p className=\"text-sm text-gray-500 mt-2\">Loading inquiries...</p>\n                </div>\n              ) : (\n                /* Active Chats */\n              <div className=\"space-y-1 px-2\">\n                {chats.length === 0 ? (\n                  <div className=\"p-4 text-sm text-gray-500\">No conversations yet. Start an inquiry from a unit to chat with a manager.</div>\n                ) : (\n                  chats.map((chat) => (\n                    <div\n                      key={chat.id}\n                      onClick={() => setSelectedChatId(chat.id)}\n                      className={`p-3 rounded-lg cursor-pointer transition-colors ${\n                        selectedChatId === chat.id ? 'bg-gray-200' : 'hover:bg-gray-100'\n                      }`}\n                    >\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"relative\">\n                          <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                            <span className=\"text-sm font-medium text-blue-600\">{chat.avatar}</span>\n                          </div>\n                          {chat.status === 'online' && (\n                            <div className=\"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"></div>\n                          )}\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between\">\n                            <p className=\"text-sm font-medium text-gray-900 truncate\">{chat.managerName}</p>\n                            <span className=\"text-xs text-gray-500\">{chat.messages[chat.messages.length - 1]?.time}</span>\n                          </div>\n                          <p className=\"text-xs text-gray-600 truncate\">{chat.property}</p>\n                          <p className=\"text-xs text-gray-500 truncate\">{\n                            String(chat.messages[chat.messages.length - 1]?.text || '')\n                              .replace(/---\\s*Manager Reply\\s*\\[\\d{10,}\\]\\s*---/g, '')\n                              .replace(/---\\s*New Message\\s*(?:\\[\\d{10,}\\])?\\s*---/g, '')\n                          }</p>\n                        </div>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n              )}\n            </div>\n          </div>\n\n          {/* Right Panel - Chat Conversation */}\n          <div className=\"flex-1 flex flex-col bg-white\">\n            {/* Chat Header */}\n            <div className=\"flex items-center justify-between p-4 border-b border-gray-200\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"relative\">\n                  <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                    <span className=\"text-sm font-medium text-blue-600\">\n                      {selectedChat?.avatar || 'PM'}\n                    </span>\n                  </div>\n                    {selectedChat?.status === 'online' && (\n                    <div className=\"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"></div>\n                  )}\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-900\">\n                    {selectedChat?.managerName || 'Property Manager'}\n                  </h3>\n                  <p className=\"text-xs text-gray-500\">\n                    {selectedChat?.unitName || selectedChat?.property || 'Property'}\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <button className=\"p-2 text-gray-500 hover:text-black hover:bg-gray-100 rounded-lg transition-colors\">\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\" />\n                  </svg>\n                </button>\n                <button className=\"p-2 text-gray-500 hover:text-black hover:bg-gray-100 rounded-lg transition-colors\">\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\" />\n                  </svg>\n                </button>\n              </div>\n            </div>\n\n            {/* Messages */}\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n              {selectedChat?.messages?.map((msg) => (\n                <div\n                  key={msg.id}\n                  className={`flex ${msg.sender === 'tenant' ? 'justify-end' : 'justify-start'}`}\n                >\n                  <div\n                    className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${\n                      msg.sender === 'tenant'\n                        ? 'bg-black text-white'\n                        : 'bg-gray-200 text-gray-900'\n                    }`}\n                  >\n                    <p className=\"text-sm\">{msg.text}</p>\n                    <p className={`text-xs mt-1 ${\n                      msg.sender === 'tenant' ? 'text-gray-300' : 'text-gray-500'\n                    }`}>\n                      {msg.time}\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Attachments Display */}\n            {selectedChat && attachments[selectedChat.id] && attachments[selectedChat.id].length > 0 && (\n              <div className=\"px-4 py-2 border-t border-gray-200 bg-gray-50\">\n                <p className=\"text-xs text-gray-600 mb-2 font-medium\">Attachments:</p>\n                <div className=\"flex flex-wrap gap-2\">\n                  {attachments[selectedChat.id].map(att => (\n                    <div key={att.id} className=\"flex items-center space-x-2 bg-white px-3 py-2 rounded-lg border border-gray-200\">\n                      <span className=\"text-sm text-gray-700 truncate max-w-[150px]\">{att.file_name}</span>\n                      <button\n                        onClick={() => handleDownloadAttachment(att.id, att.file_name)}\n                        className=\"text-blue-600 hover:text-blue-800 text-sm\"\n                      >\n                        Download\n                      </button>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Message Input */}\n            <div className=\"p-4 border-t border-gray-200\">\n              {/* File Selection Preview */}\n              {selectedFiles.length > 0 && (\n                <div className=\"mb-2 flex flex-wrap gap-2\">\n                  {selectedFiles.map((file, idx) => (\n                    <div key={idx} className=\"flex items-center space-x-2 bg-gray-100 px-3 py-1 rounded-lg text-sm\">\n                      <span className=\"text-gray-700\">{file.name}</span>\n                      <button\n                        onClick={() => setSelectedFiles(prev => prev.filter((_, i) => i !== idx))}\n                        className=\"text-red-600 hover:text-red-800\"\n                      >\n                        Ã—\n                      </button>\n                    </div>\n                  ))}\n                  <button\n                    onClick={handleFileUpload}\n                    disabled={uploadingFiles}\n                    className=\"bg-blue-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50\"\n                  >\n                    {uploadingFiles ? 'Uploading...' : 'Upload'}\n                  </button>\n                </div>\n              )}\n              \n              <div className=\"flex items-center space-x-3\">\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  multiple\n                  accept=\"image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx\"\n                  onChange={handleFileSelect}\n                  className=\"hidden\"\n                  id=\"file-input\"\n                />\n                <label\n                  htmlFor=\"file-input\"\n                  className=\"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors cursor-pointer\"\n                >\n                  <svg className=\"w-5 h-5 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\n                  </svg>\n                </label>\n                <input\n                  ref={messageInputRef}\n                  type=\"text\"\n                  value={message || ''}\n                  onChange={(e) => setMessage(e.target.value)}\n                  onKeyPress={handleKeyPress}\n                  placeholder=\"Type your message to the property manager...\"\n                  className=\"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-black placeholder-gray-400\"\n                />\n                <button\n                  onClick={handleSendMessage}\n                  disabled={loading || !message.trim()}\n                  className=\"w-10 h-10 bg-black rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {loading ? (\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                  ) : (\n                  <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\n                  </svg>\n                  )}\n                </button>\n              </div>\n              <p className=\"text-xs text-gray-500 mt-2 text-center\">\n                You're chatting with the property manager about {selectedChat?.unitName || selectedChat?.property || 'this unit'}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Inquiries;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}